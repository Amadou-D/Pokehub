<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokémon TCG Dex</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Press+Start+2P&display=swap" rel="stylesheet">

    <style>
        /* --- Base Variables (Fallback/Structure) --- */
        :root {
            --pokemon-red: #FF0000;
            --pokemon-blue: #3B4CCA;
            --pokemon-yellow: #FFDE00;
            --dark-charcoal: #333333;
            --medium-grey: #6c757d;
            --light-grey: #f8f9fa;
            --white: #ffffff;
            --border-radius-main: 12px;
            --border-radius-small: 8px;
            --card-width: 245px;
            --transition-speed: 0.3s;

             /* Default theme variables (using original colors as default) */
             --theme-bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
             --theme-container-bg: rgba(255, 255, 255, 0.95);
             --theme-container-border: rgba(0, 0, 0, 0.1);
             --theme-container-shadow: rgba(0,0,0,0.1);
             --theme-text-primary: var(--dark-charcoal);
             --theme-text-secondary: #666666; /* Original medium grey */
             --theme-text-accent: var(--pokemon-blue);
             --theme-text-heading: var(--pokemon-red);
             --theme-heading-shadow: var(--pokemon-yellow);
             --theme-button-primary-bg: var(--pokemon-blue); /* Solid color for default */
             --theme-button-primary-hover-bg: var(--pokemon-yellow);
             --theme-button-primary-text: var(--white);
             --theme-button-pagination-bg: var(--pokemon-blue);
             --theme-button-pagination-hover-bg: var(--pokemon-yellow);
             --theme-button-pagination-text: var(--white);
             --theme-input-border: #ddd;
             --theme-input-focus-border: var(--pokemon-blue);
             --theme-input-focus-shadow: rgba(59, 76, 202, 0.2);
             --theme-card-bg: var(--white);
             --theme-card-info-bg: #f9f9f9; /* Original light grey */
             --theme-card-border: #eee;
             --theme-card-shadow: rgba(0,0,0,0.1);
             --theme-placeholder-bg: url('https://assets.pokemon.com/assets/cms2/img/misc/virtual-backgrounds/masters/forest.jpg');
             --theme-placeholder-overlay: rgba(255, 255, 255, 0.6);
             --theme-placeholder-message-bg: rgba(0, 0, 0, 0.6);
             --theme-placeholder-message-text: var(--white);
             --theme-loader-border: var(--dark-charcoal);
             --theme-loader-top: var(--pokemon-red);
             --theme-market-link-bg: #ffba00;
             --theme-market-link-hover-bg: #e6a800;
             --theme-market-link-text: var(--dark-charcoal);
             --theme-hr-color: #eee;
             --theme-decor-opacity: 0;
             --theme-decor-image-left: none;
             --theme-decor-image-right: none;
             --theme-accent-heart: var(--pokemon-red);
             --theme-error-bg: #ffebeb;
             --theme-error-text: var(--pokemon-red);
        }

        /* --- Eevee Theme Variables --- */
        body.theme-eevee {
            --theme-bg-gradient: linear-gradient(135deg, #e2f7cb 0%, #b7e8f7 100%);
            --theme-container-bg: rgba(253, 246, 233, 0.9);
            --theme-container-border: rgba(143, 107, 80, 0.3);
            --theme-container-shadow: rgba(143, 107, 80, 0.2);
            --theme-text-primary: #5c4033;
            --theme-text-secondary: #a07a5f;
            --theme-text-accent: #705848;
            --theme-text-heading: #8f6b50;
            --theme-heading-shadow: #f8d030;
            --theme-button-primary-bg: linear-gradient(145deg, #f08030, #c06020);
            --theme-button-primary-hover-bg: linear-gradient(145deg, #ffa050, #f08030);
            --theme-button-pagination-bg: linear-gradient(145deg, #c8a17f, #8f6b50);
            --theme-button-pagination-hover-bg: linear-gradient(145deg, #d8b18f, #c8a17f);
            --theme-input-border: #c8a17f;
            --theme-input-focus-border: #8f6b50;
            --theme-input-focus-shadow: rgba(143, 107, 80, 0.2);
            --theme-card-info-bg: #fdf6e9;
            --theme-card-border: #e0d8cc;
            --theme-card-shadow: rgba(143, 107, 80, 0.15);
            --theme-placeholder-bg: linear-gradient(45deg, rgba(199, 161, 127, 0.1) 25%, transparent 25%), linear-gradient(-45deg, rgba(199, 161, 127, 0.1) 25%, transparent 25%), linear-gradient(45deg, transparent 75%, rgba(199, 161, 127, 0.1) 75%), linear-gradient(-45deg, transparent 75%, rgba(199, 161, 127, 0.1) 75%);
            --theme-placeholder-overlay: #f4eeda;
            --theme-placeholder-message-bg: rgba(143, 107, 80, 0.8);
            --theme-placeholder-message-text: #fdf6e9;
            --theme-loader-border: #c8a17f;
            --theme-loader-top: #f85888;
            --theme-market-link-bg: #f8d030;
            --theme-market-link-hover-bg: color-mix(in srgb, #f8d030 85%, black);
            --theme-hr-color: #c8a17f;
            --theme-decor-opacity: 0.25;
            --theme-decor-image-left: url('https://assets.pokemon.com/assets/cms2/img/pokedex/full/133.png');
            --theme-decor-image-right: url('https://assets.pokemon.com/assets/cms2/img/pokedex/full/133.png');
            --theme-accent-heart: #f0b6bc;
            --theme-error-bg: rgba(160, 60, 48, 0.1);
            --theme-error-text: #a03c30;
        }

        /* --- Gengar Theme Variables --- */
        body.theme-gengar {
            --theme-bg-gradient: linear-gradient(135deg, #3d1d52 0%, #1c0d2a 100%);
            --theme-container-bg: rgba(50, 30, 70, 0.85);
            --theme-container-border: rgba(180, 120, 220, 0.4);
            --theme-container-shadow: rgba(20, 10, 30, 0.5);
            --theme-text-primary: #e8dff5;
            --theme-text-secondary: #bca6d8;
            --theme-text-accent: #ff5f98;
            --theme-text-heading: #e8dff5;
            --theme-heading-shadow: #ff5f98;
            --theme-button-primary-bg: linear-gradient(145deg, #7c45a3, #502d6b);
            --theme-button-primary-hover-bg: linear-gradient(145deg, #9b60c7, #7c45a3);
            --theme-button-pagination-bg: linear-gradient(145deg, #7c45a3, #502d6b);
            --theme-button-pagination-hover-bg: linear-gradient(145deg, #9b60c7, #7c45a3);
            --theme-input-border: #7c45a3;
            --theme-input-focus-border: #ff5f98;
            --theme-input-focus-shadow: rgba(255, 95, 152, 0.2);
            --theme-card-bg: rgba(60, 40, 80, 0.9);
            --theme-card-info-bg: rgba(30, 15, 45, 0.9);
            --theme-card-border: #502d6b;
            --theme-card-shadow: rgba(0,0,0, 0.3);
            --theme-placeholder-bg: radial-gradient(circle, rgba(124, 69, 163, 0.2) 10%, transparent 11%), radial-gradient(circle, rgba(124, 69, 163, 0.15) 10%, transparent 11%);
            --theme-placeholder-overlay: #2c1a3e;
            --theme-placeholder-message-bg: rgba(255, 95, 152, 0.7);
            --theme-placeholder-message-text: var(--white);
            --theme-loader-border: #7c45a3;
            --theme-loader-top: #ff5f98;
            --theme-market-link-bg: #ff5f98;
            --theme-market-link-hover-bg: color-mix(in srgb, #ff5f98 85%, black);
            --theme-market-link-text: var(--white);
            --theme-hr-color: #502d6b;
            --theme-decor-opacity: 0.15;
            --theme-decor-image-left: url('https://assets.pokemon.com/assets/cms2/img/pokedex/full/094.png');
            --theme-decor-image-right: url('https://assets.pokemon.com/assets/cms2/img/pokedex/full/093.png');
            --theme-accent-heart: #ff5f98;
            --theme-error-bg: rgba(255, 95, 152, 0.15);
            --theme-error-text: #ffc1d6;
        }

        /* --- Dragonite Theme Variables --- */
        body.theme-dragonite {
            --theme-bg-gradient: linear-gradient(135deg, #fceabb 0%, #f8b500 100%);
            --theme-container-bg: rgba(255, 255, 255, 0.9);
            --theme-container-border: rgba(248, 181, 0, 0.5);
            --theme-container-shadow: rgba(100, 70, 20, 0.2);
            --theme-text-primary: #5c4b33;
            --theme-text-secondary: #a08b5f;
            --theme-text-accent: #60a0d8;
            --theme-text-heading: #e87c1c;
            --theme-heading-shadow: #fceabb;
            --theme-button-primary-bg: linear-gradient(145deg, #e87c1c, #c06010);
            --theme-button-primary-hover-bg: linear-gradient(145deg, #ff9c3c, #e87c1c);
            --theme-button-pagination-bg: linear-gradient(145deg, #60a0d8, #4070a8);
            --theme-button-pagination-hover-bg: linear-gradient(145deg, #80c0f8, #60a0d8);
            --theme-input-border: #f8b500;
            --theme-input-focus-border: #e87c1c;
            --theme-input-focus-shadow: rgba(232, 124, 28, 0.2);
            --theme-card-info-bg: #fff8e1;
            --theme-card-border: #ffe0b2;
            --theme-card-shadow: rgba(232, 124, 28, 0.15);
            --theme-placeholder-bg: url('https://pbs.twimg.com/media/Exrkz50VoAQv3Qp.jpg');
            --theme-placeholder-overlay: rgba(255, 255, 255, 0.7);
            --theme-placeholder-message-bg: rgba(232, 124, 28, 0.85);
            --theme-placeholder-message-text: var(--white);
            --theme-loader-border: #f8b500;
            --theme-loader-top: #e87c1c;
            --theme-market-link-bg: #60a0d8;
            --theme-market-link-hover-bg: color-mix(in srgb, #60a0d8 85%, black);
            --theme-market-link-text: var(--white);
            --theme-hr-color: #f8b500;
            --theme-decor-opacity: 0.2;
            --theme-decor-image-left: url('https://assets.pokemon.com/assets/cms2/img/pokedex/full/149.png');
            --theme-decor-image-right: url('https://assets.pokemon.com/assets/cms2/img/pokedex/full/148.png');
            --theme-accent-heart: #e87c1c;
            --theme-error-bg: rgba(232, 124, 28, 0.1);
            --theme-error-text: #c06010;
        }

        /* --- Charizard Theme Variables --- */
        body.theme-charizard {
            --theme-bg-gradient: linear-gradient(135deg, #f08030 0%, #a02c2c 100%);
            --theme-container-bg: rgba(255, 235, 215, 0.9);
            --theme-container-border: rgba(240, 128, 48, 0.5);
            --theme-container-shadow: rgba(160, 44, 44, 0.3);
            --theme-text-primary: #4d1a00;
            --theme-text-secondary: #a05c30;
            --theme-text-accent: #5888a8;
            --theme-text-heading: #f08030;
            --theme-heading-shadow: #a02c2c;
            --theme-button-primary-bg: linear-gradient(145deg, #e04000, #a02000);
            --theme-button-primary-hover-bg: linear-gradient(145deg, #ff6020, #e04000);
            --theme-button-pagination-bg: linear-gradient(145deg, #f08030, #c06020);
            --theme-button-pagination-hover-bg: linear-gradient(145deg, #ff9c3c, #f08030);
            --theme-input-border: #f08030;
            --theme-input-focus-border: #a02c2c;
            --theme-input-focus-shadow: rgba(240, 128, 48, 0.25);
            --theme-card-info-bg: #fff0e0;
            --theme-card-border: #ffccaa;
            --theme-card-shadow: rgba(240, 128, 48, 0.2);
            --theme-placeholder-bg: url('https://wallpapercave.com/wp/wp6694326.jpg');
            --theme-placeholder-overlay: rgba(255, 160, 80, 0.6);
            --theme-placeholder-message-bg: rgba(160, 44, 44, 0.85);
            --theme-placeholder-message-text: var(--white);
            --theme-loader-border: #f08030;
            --theme-loader-top: #a02c2c;
            --theme-market-link-bg: #5888a8;
            --theme-market-link-hover-bg: color-mix(in srgb, #5888a8 85%, black);
            --theme-market-link-text: var(--white);
            --theme-hr-color: #f08030;
            --theme-decor-opacity: 0.25;
            --theme-decor-image-left: url('https://assets.pokemon.com/assets/cms2/img/pokedex/full/006.png');
            --theme-decor-image-right: url('https://assets.pokemon.com/assets/cms2/img/pokedex/full/005.png');
            --theme-accent-heart: #f08030;
            --theme-error-bg: rgba(160, 44, 44, 0.15);
            --theme-error-text: #a02c2c;
        }

        /* --- Pikachu Theme Variables --- */
        body.theme-pikachu {
            --theme-bg-gradient: linear-gradient(135deg, #fff352 0%, #ffcc00 100%);
            --theme-container-bg: rgba(255, 250, 230, 0.92);
            --theme-container-border: rgba(204, 153, 0, 0.5);
            --theme-container-shadow: rgba(102, 77, 0, 0.25);
            --theme-text-primary: #4d3d00;
            --theme-text-secondary: #997a00;
            --theme-text-accent: #e60000;
            --theme-text-heading: #4d3d00;
            --theme-heading-shadow: #e60000;
            --theme-button-primary-bg: linear-gradient(145deg, #f8d030, #c1a000);
            --theme-button-primary-hover-bg: linear-gradient(145deg, #ffea50, #f8d030);
            --theme-button-primary-text: #4d3d00;
            --theme-button-pagination-bg: linear-gradient(145deg, #f8d030, #c1a000);
            --theme-button-pagination-hover-bg: linear-gradient(145deg, #ffea50, #f8d030);
            --theme-button-pagination-text: #4d3d00;
            --theme-input-border: #f8d030;
            --theme-input-focus-border: #e60000;
            --theme-input-focus-shadow: rgba(230, 0, 0, 0.2);
            --theme-card-info-bg: #fffacd;
            --theme-card-border: #ffe8a1;
            --theme-card-shadow: rgba(204, 153, 0, 0.2);
            --theme-placeholder-bg: radial-gradient(ellipse at center, #fff352cc 0%, #ffcc00cc 100%); /* Yellow gradient, slightly transparent */
            --theme-placeholder-overlay: rgba(255, 255, 255, 0.1); /* Minimal overlay */
            --theme-placeholder-message-bg: rgba(77, 61, 0, 0.8);
            --theme-placeholder-message-text: #fff352;
            --theme-loader-border: #f8d030;
            --theme-loader-top: #e60000;
            --theme-market-link-bg: #e60000;
            --theme-market-link-hover-bg: color-mix(in srgb, #e60000 85%, black);
            --theme-market-link-text: var(--white);
            --theme-hr-color: #f8d030;
            --theme-decor-opacity: 0.2;
            --theme-decor-image-left: url('https://assets.pokemon.com/assets/cms2/img/pokedex/full/025.png');
            --theme-decor-image-right: url('https://assets.pokemon.com/assets/cms2/img/pokedex/full/026.png');
            --theme-accent-heart: #e60000;
            --theme-error-bg: rgba(230, 0, 0, 0.1);
            --theme-error-text: #b30000;
        }


        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Lato', sans-serif;
            line-height: 1.6;
            background: var(--theme-bg-gradient);
            color: var(--theme-text-primary);
            padding: 20px;
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            position: relative;
            overflow-x: hidden;
            transition: background var(--transition-speed) ease;
        }

        /* Decorations */
        body::before, body::after {
            content: ''; position: fixed; top: 50%; transform: translateY(-50%);
            width: 150px; height: 150px; background-size: contain; background-repeat: no-repeat;
            z-index: -1; opacity: var(--theme-decor-opacity); pointer-events: none;
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.1));
            transition: opacity var(--transition-speed) ease, background-image var(--transition-speed) ease;
        }
        body::before { left: 2vw; background-image: var(--theme-decor-image-left); }
        body::after { right: 2vw; background-image: var(--theme-decor-image-right); transform: translateY(-50%) scaleX(-1); }
        @media (max-width: 1600px) { body::before, body::after { width: 120px; height: 120px; opacity: calc(var(--theme-decor-opacity) * 0.8); } body::before{ left: 1vw; } body::after{ right: 1vw; } }
        @media (max-width: 1300px) { body::before, body::after { display: none; } }

        #container {
            width: 100%; max-width: 1200px;
            margin: 30px auto; background-color: var(--theme-container-bg);
            backdrop-filter: blur(5px); padding: 35px 45px; border-radius: var(--border-radius-main);
            box-shadow: 0 8px 25px var(--theme-container-shadow); border: 1px solid var(--theme-container-border);
            display: flex; flex-direction: column; min-height: calc(100vh - 60px); position: relative; z-index: 1;
            transition: background-color var(--transition-speed) ease, border-color var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
        }
        #container:hover { box-shadow: 0 8px 25px var(--theme-container-shadow); }

        main { flex-grow: 1; position: relative; }

        /* Theme Switcher */
        #theme-switcher {
            text-align: center;
            margin-bottom: 25px;
            margin-top: -15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
        }
        .theme-button {
            background: var(--theme-button-secondary-bg, var(--medium-grey));
            color: var(--theme-button-secondary-text, var(--white));
            border: 1px solid rgba(0,0,0,0.2); padding: 6px 12px;
            margin: 0;
            border-radius: var(--border-radius-small); cursor: pointer; font-size: 0.8rem;
            font-family: 'Lato', sans-serif; transition: all 0.2s ease; opacity: 0.7;
             flex-shrink: 0;
        }
        .theme-button:hover, .theme-button.active { opacity: 1; transform: scale(1.05); box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .theme-button[data-theme="eevee"] { background-color: #c8a17f; color: #fff;}
        .theme-button[data-theme="gengar"] { background-color: #7c45a3; color: #fff;}
        .theme-button[data-theme="dragonite"] { background-color: #e87c1c; color: #fff;}
        .theme-button[data-theme="charizard"] { background-color: #f08030; color: #fff;}
        .theme-button[data-theme="pikachu"] { background-color: #f8d030; color: #4d3d00;}


        /* H1 uses theme vars */
        h1 {
            font-family: 'Press Start 2P', cursive; text-align: center;
            color: var(--theme-text-heading);
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            margin-bottom: 35px;
            text-shadow: 2px 2px var(--theme-heading-shadow);
            transition: color var(--transition-speed) ease, text-shadow var(--transition-speed) ease;
        }

        /* Search Controls */
        #search-controls { display: flex; flex-wrap: wrap; justify-content: center; align-items: flex-start; margin-bottom: 40px; gap: 20px; }
        .search-field-group { display: flex; flex-direction: column; gap: 5px; position: relative; width: 240px; }
        #search-controls label { font-weight: bold; color: var(--theme-text-secondary); font-size: 0.9rem; text-align: left; margin-left: 3px; transition: color var(--transition-speed) ease; }
        #pokemonNameInput, #setNameInput, #raritySelect {
            padding: 12px 15px; border: 2px solid var(--theme-input-border); border-radius: var(--border-radius-main); font-size: 1rem;
            transition: border-color var(--transition-speed) ease, box-shadow var(--transition-speed) ease, background-color var(--transition-speed) ease, color var(--transition-speed) ease;
            outline: none; width: 100%; background-color: var(--theme-card-bg); color: var(--theme-text-primary); position: relative; z-index: 102;
        }
        #raritySelect { height: 48px; -webkit-appearance: none; appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 16px 12px; padding-right: 2.5rem; }
         #pokemonNameInput::placeholder, #setNameInput::placeholder { color: var(--theme-text-secondary); opacity: 0.8; }
        #pokemonNameInput:focus, #setNameInput:focus, #raritySelect:focus { border-color: var(--theme-input-focus-border); box-shadow: 0 0 0 3px var(--theme-input-focus-shadow); }
        #searchButton {
            padding: 12px 25px; background: var(--theme-button-primary-bg); color: var(--theme-button-primary-text); border: none;
            border-radius: var(--border-radius-main); cursor: pointer; font-size: 1rem; font-weight: bold;
            transition: all var(--transition-speed) ease; white-space: nowrap; height: 48px;
            align-self: flex-end;
            position: relative; z-index: 102; margin-top: 24px; box-shadow: 0 2px 5px rgba(0,0,0, 0.2);
        }
        #searchButton:hover { background: var(--theme-button-primary-hover-bg); transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0, 0.3); }

        /* Autocomplete */
        .suggestions-container {
            display: none; position: absolute; top: 100%; left: 0; right: 0; max-height: 200px; overflow-y: auto;
            background-color: var(--theme-card-bg); border: 1px solid var(--theme-input-border); border-top: none;
            border-radius: 0 0 var(--border-radius-main) var(--border-radius-main); box-shadow: 0 6px 12px rgba(0,0,0, 0.15);
            z-index: 101; margin-top: -2px; scrollbar-width: thin; scrollbar-color: var(--theme-text-secondary) var(--theme-card-info-bg);
            transition: background-color var(--transition-speed) ease, border-color var(--transition-speed) ease;
        }
         .suggestions-container::-webkit-scrollbar { width: 8px; }
         .suggestions-container::-webkit-scrollbar-track { background: var(--theme-card-info-bg); border-radius: 0 0 var(--border-radius-main) 0; }
         .suggestions-container::-webkit-scrollbar-thumb { background-color: var(--theme-text-secondary); border-radius: 4px; border: 2px solid var(--theme-card-info-bg); }
        .suggestion-item {
            padding: 8px 12px; font-size: 0.9rem; color: var(--theme-text-primary); cursor: pointer;
            border-bottom: 1px solid var(--theme-hr-color); background-color: transparent;
            transition: background-color 0.15s ease, color 0.15s ease; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .suggestion-item:last-child { border-bottom: none; }
        .suggestion-item:hover, .suggestion-item.active { background-color: var(--theme-card-info-bg); color: var(--theme-text-accent); }

        /* Loader */
        #loader {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 60px; height: 60px; border-radius: 50%; z-index: 1001;
            border: 4px solid var(--theme-loader-border); border-top-color: var(--theme-loader-top);
            animation: spin 1s linear infinite; background: transparent; box-shadow: none;
        }
        #loader::before { display: none; }
        @keyframes spin { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }

        /* Results Placeholder */
        #results.results-placeholder {
            background-color: var(--theme-placeholder-overlay);
            background-image: var(--theme-placeholder-bg);
             background-size: cover;
             background-position: center;
             body.theme-eevee & { background-size: 20px 20px; background-position: 0 0, 0 10px, 10px -10px, -10px 0px; }
             body.theme-gengar & { background-size: 40px 40px; background-position: 0 0, 0 0; }
             body.theme-pikachu & { background-image: radial-gradient(ellipse at center, #fff352cc 0%, #ffcc00cc 100%); } /* Override for gradient */

            border-radius: var(--border-radius-main); min-height: 300px; display: flex; align-items: center; justify-content: center;
            transition: background var(--transition-speed) ease; padding-top: 0; border: 1px dashed var(--theme-input-border);
        }
        #results.results-placeholder .message {
            background-color: var(--theme-placeholder-message-bg); color: var(--theme-placeholder-message-text);
            padding: 15px 25px; border-radius: var(--border-radius-main); font-style: normal; font-size: 1.2rem;
            max-width: 80%; box-shadow: 0 2px 10px rgba(0,0,0,0.2); width: auto; text-align: center;
            transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease;
        }

        /* Results Area */
        #results {
            margin-top: 30px; border-top: 1px solid var(--theme-hr-color); display: flex; flex-wrap: wrap; gap: 25px;
            justify-content: center; position: relative; transition: border-color var(--transition-speed) ease;
        }
        #results:not(.results-placeholder) { padding-top: 30px; min-height: 150px; }

        /* Messages */
        #results .message:not(.results-placeholder .message) {
             width: 100%; text-align: center; font-size: 1.1rem; color: var(--theme-text-secondary); padding: 30px 15px;
             font-style: italic; background-color: transparent; box-shadow: none; transition: color var(--transition-speed) ease;
        }
         #results .error {
             color: var(--theme-error-text) !important; font-weight: bold; font-style: normal;
             background-color: var(--theme-error-bg);
             border: 1px solid var(--theme-error-text); border-radius: var(--border-radius-main);
             padding: 15px; width: 95%; margin: 0 auto;
             transition: background-color var(--transition-speed) ease, border-color var(--transition-speed) ease, color var(--transition-speed) ease;
         }

        /* Card */
        .card-container {
            background-color: var(--theme-card-bg); border-radius: var(--border-radius-main);
            box-shadow: 0 4px 10px var(--theme-card-shadow); transition: all var(--transition-speed) ease;
            width: var(--card-width); overflow: hidden; display: flex; flex-direction: column;
            border: 1px solid var(--theme-card-border);
        }
        .card-container:hover { transform: translateY(-5px); box-shadow: 0 6px 15px color-mix(in srgb, var(--theme-card-shadow) 100%, black 20%); }
        .card-image { display: block; width: 100%; height: auto; max-height: 340px; object-fit: contain; background-color: var(--light-grey); cursor: pointer; }
        .card-info {
            padding: 12px 15px; font-size: 0.85rem; text-align: center; background-color: var(--theme-card-info-bg);
            border-top: 1px solid var(--theme-hr-color); margin-top: auto; color: var(--theme-text-primary);
            transition: background-color var(--transition-speed) ease, border-color var(--transition-speed) ease, color var(--transition-speed) ease;
        }
        .card-info strong { color: var(--theme-text-accent); display: block; margin-bottom: 4px; font-size: 0.9rem; transition: color var(--transition-speed) ease; }
        .card-info span { color: var(--theme-text-secondary); display: block; margin-bottom: 8px; transition: color var(--transition-speed) ease; }
        .market-link {
            display: inline-block; margin-top: 5px; padding: 6px 12px; font-size: 0.8rem; font-weight: bold;
            color: var(--theme-market-link-text); background-color: var(--theme-market-link-bg);
            border: none; border-radius: 5px; text-decoration: none; transition: all 0.2s ease; cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        .market-link:hover { background-color: var(--theme-market-link-hover-bg); transform: translateY(-1px); box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
        .market-link:active { transform: translateY(0px); }

        /* Pagination */
        #pagination-controls { display: flex; justify-content: center; align-items: center; padding: 25px 0 10px 0; margin-top: 20px; gap: 15px; width: 100%; }
        .pagination-button {
            padding: 8px 16px; background: var(--theme-button-pagination-bg); color: var(--theme-button-pagination-text);
            border: none; border-radius: var(--border-radius-main); cursor: pointer; font-size: 0.9rem; font-weight: bold;
            transition: all 0.3s ease; box-shadow: 0 2px 4px rgba(0,0,0, 0.2);
        }
        /* Handle hover based on theme */
        body.theme-eevee .pagination-button:hover:not(:disabled) { background: linear-gradient(145deg, #d8b18f, #c8a17f); }
        body.theme-gengar .pagination-button:hover:not(:disabled) { background: linear-gradient(145deg, #9b60c7, #7c45a3); }
        body.theme-dragonite .pagination-button:hover:not(:disabled) { background: linear-gradient(145deg, #80c0f8, #60a0d8); }
        body.theme-charizard .pagination-button:hover:not(:disabled) { background: linear-gradient(145deg, #ff9c3c, #f08030); }
        body.theme-pikachu .pagination-button:hover:not(:disabled) { background: linear-gradient(145deg, #ffea50, #f8d030); }

        .pagination-button:hover:not(:disabled) { transform: translateY(-1px); box-shadow: 0 3px 6px rgba(0,0,0, 0.3); }
        .pagination-button:disabled { background: var(--medium-grey); color: #ccc; cursor: not-allowed; opacity: 0.7; box-shadow: none; }
        #page-info { font-size: 1rem; color: var(--theme-text-primary); font-weight: bold; transition: color var(--transition-speed) ease; }

        /* Modal */
        #modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.85); cursor: pointer; padding-top: 50px; }
        #modal-content { margin: auto; display: block; width: 80%; max-width: 350px; cursor: default; }
        #modal-image { width: 100%; height: auto; border-radius: 15px; }
        #close-modal { position: absolute; top: 15px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; transition: 0.3s; cursor: pointer; user-select: none; }
        #close-modal:hover, #close-modal:focus { color: var(--theme-text-accent); text-decoration: none; }

        /* Footer */
        .page-footer {
            width: 100%; text-align: center; margin-top: auto; padding-top: 20px;
            border-top: 1px solid var(--theme-hr-color); font-size: 0.9rem; color: var(--theme-text-secondary);
            transition: border-color var(--transition-speed) ease, color var(--transition-speed) ease;
        }
        .page-footer a { color: var(--theme-text-accent); text-decoration: none; transition: color 0.2s ease; font-weight: bold; }
        .page-footer a:hover { color: color-mix(in srgb, var(--theme-text-accent) 80%, white); }
        .page-footer .heart { color: var(--theme-accent-heart); animation: pulse 1.5s infinite ease-in-out; }
        .page-footer .creator-name { font-weight: bold; color: var(--theme-text-primary); }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }

        /* --- Responsive --- */
         @media (max-width: 992px) { .search-field-group { width: 220px; } #container { padding: 30px 30px; max-width: 960px; } }
         @media (max-width: 768px) { #search-controls { gap: 15px; } .search-field-group { width: calc(50% - 20px); } #searchButton { width: calc(100% - 20px); margin-top: 10px; align-self: center; } .card-container { width: calc(33.333% - 18px); } }
         @media (max-width: 650px) {
             body { padding: 15px 5px; }
             #container { padding: 25px 15px; margin: 20px auto; min-height: calc(100vh - 40px); }
             h1 { font-size: 1.4rem; margin-bottom: 30px; }
             /* Theme Switcher Mobile */
             #theme-switcher { margin-bottom: 20px; gap: 5px 8px; }
             .theme-button { padding: 4px 8px; font-size: 0.7rem; margin: 2px 0;}

             #search-controls { flex-direction: column; align-items: center; gap: 10px; }
             .search-field-group { width: 90%; max-width: 350px; align-items: center; }
             #searchButton { width: 90%; max-width: 350px; align-self: center; margin-top: 5px; height: 47px; }
             #search-controls label { text-align: center; margin-left: 0; }
             .suggestions-container { position: relative; top: auto; left: auto; right: auto; width: 100%; margin-top: 2px; border-radius: var(--border-radius-main); border: 1px solid var(--theme-input-border); max-height: 150px; }
             #results { gap: 15px; } #results.results-placeholder { min-height: 250px; }
             .card-container { width: calc(50% - 15px); }
             #pagination-controls { gap: 10px; } .pagination-button { padding: 6px 12px; font-size: 0.8rem; } #page-info { font-size: 0.9rem; }
         }
         @media (max-width: 480px) { #results.results-placeholder { min-height: 200px; } #results.results-placeholder .message { font-size: 1rem; padding: 10px 15px; } .card-container { width: calc(100% - 10px); max-width: 300px; } .card-image { max-height: 350px; } }

    </style>
</head>
<body class="theme-eevee">

    <div id="container">
        <main>
             <div id="theme-switcher">
                 <button class="theme-button" data-theme="eevee">Eevee</button>
                 <button class="theme-button" data-theme="gengar">Gengar</button>
                 <button class="theme-button" data-theme="dragonite">Dragonite</button>
                 <button class="theme-button" data-theme="charizard">Charizard</button>
                 <button class="theme-button" data-theme="pikachu">Pikachu</button>
             </div>

            <h1>Pokémon TCG Dex</h1>

            <div id="search-controls">
                <div class="search-field-group">
                    <label for="pokemonNameInput">Pokémon Name:</label>
                    <input type="text" id="pokemonNameInput" placeholder="e.g., Pikachu" autocomplete="off">
                    <div id="pokemon-suggestions-container" class="suggestions-container"></div>
                </div>
                <div class="search-field-group">
                    <label for="setNameInput">Set Name:</label>
                    <input type="text" id="setNameInput" placeholder="e.g., Base Set" autocomplete="off">
                    <div id="set-suggestions-container" class="suggestions-container"></div>
                </div>
                <div class="search-field-group">
                    <label for="raritySelect">Rarity:</label>
                    <select id="raritySelect">
                    <option value="">Any Rarity</option>
                    <option value="Common">Common</option>
                    <option value="Uncommon">Uncommon</option>
                    <option value="Rare">Rare</option>
                    <option value="Rare Holo">Rare Holo</option>
                    <option value="Double Rare">Double Rare (ex, V)</option>
                    <option value="Illustration Rare">Illustration Rare</option>
                    <option value="Special Illustration Rare">Special Illustration Rare</option>
                    <option value="Ultra Rare">Ultra Rare (Full Art)</option>
                    <option value="Hyper Rare">Hyper Rare (Gold)</option>
                    <option value="Promo">Promo</option>
                    <option value="Amazing Rare">Amazing Rare</option>
                    <option value="Rare Holo V">Rare Holo V</option>
                    <option value="Rare Holo VMAX">Rare Holo VMAX</option>
                    <option value="Rare Holo VSTAR">Rare Holo VSTAR</option>
                    <option value="Rare Secret">Rare Secret</option>
                    <option value="Rare Rainbow">Rare Rainbow</option>
                </select>
                </div>
                <button id="searchButton">Search</button>
            </div>

            <div id="results">
            </div>

             <div id="pagination-controls"></div>

        </main>

        <footer class="page-footer" id="page-footer"></footer>
    </div>

    <div id="loader"></div>

    <div id="modal">
      <span id="close-modal" title="Close">×</span>
      <div id="modal-content">
        <img id="modal-image" src="" alt="Large Card Image">
      </div>
    </div>

    <script>
        // Element References
        const pokemonNameInput = document.getElementById('pokemonNameInput');
        const setNameInput = document.getElementById('setNameInput');
        const raritySelect = document.getElementById('raritySelect');
        const searchButton = document.getElementById('searchButton');
        const resultsDiv = document.getElementById('results');
        const loader = document.getElementById('loader');
        const modal = document.getElementById('modal');
        const modalImage = document.getElementById('modal-image');
        const closeModalSpan = document.getElementById('close-modal');
        const footerElement = document.getElementById('page-footer');
        const paginationControlsDiv = document.getElementById('pagination-controls');
        const pokemonSuggestionsContainer = document.getElementById('pokemon-suggestions-container');
        const setSuggestionsContainer = document.getElementById('set-suggestions-container');
        const themeSwitcher = document.getElementById('theme-switcher');
        const themeButtons = document.querySelectorAll('.theme-button');
        let currentAbortController = null;

        let currentPage = 1;
        let totalPages = 1;
        let currentPokemonName = '';
        let currentSetName = '';
        let currentRarity = '';
        const pageSize = 60;

        // Autocomplete Data
        const pokemonNames = [
            "Bulbasaur", "Ivysaur", "Venusaur", "Charmander", "Charmeleon", "Charizard", "Squirtle", "Wartortle", "Blastoise",
            "Caterpie", "Metapod", "Butterfree", "Weedle", "Kakuna", "Beedrill", "Pidgey", "Pidgeotto", "Pidgeot",
            "Rattata", "Raticate", "Spearow", "Fearow", "Ekans", "Arbok", "Pikachu", "Raichu", "Sandshrew", "Sandslash",
            "Nidoran♀", "Nidorina", "Nidoqueen", "Nidoran♂", "Nidorino", "Nidoking", "Clefairy", "Clefable", "Vulpix",
            "Ninetales", "Jigglypuff", "Wigglytuff", "Zubat", "Golbat", "Oddish", "Gloom", "Vileplume", "Paras",
            "Parasect", "Venonat", "Venomoth", "Diglett", "Dugtrio", "Meowth", "Persian", "Psyduck", "Golduck",
            "Mankey", "Primeape", "Growlithe", "Arcanine", "Poliwag", "Poliwhirl", "Poliwrath", "Abra", "Kadabra",
            "Alakazam", "Machop", "Machoke", "Machamp", "Bellsprout", "Weepinbell", "Victreebel", "Tentacool",
            "Tentacruel", "Geodude", "Graveler", "Golem", "Ponyta", "Rapidash", "Slowpoke", "Slowbro", "Magnemite",
            "Magneton", "Farfetch'd", "Doduo", "Dodrio", "Seel", "Dewgong", "Grimer", "Muk", "Shellder", "Cloyster",
            "Gastly", "Haunter", "Gengar", "Onix", "Drowzee", "Hypno", "Krabby", "Kingler", "Voltorb", "Electrode",
            "Exeggcute", "Exeggutor", "Cubone", "Marowak", "Hitmonlee", "Hitmonchan", "Lickitung", "Koffing",
            "Weezing", "Rhyhorn", "Rhydon", "Chansey", "Tangela", "Kangaskhan", "Horsea", "Seadra", "Goldeen",
            "Seaking", "Staryu", "Starmie", "Mr. Mime", "Scyther", "Jynx", "Electabuzz", "Magmar", "Pinsir", "Tauros",
            "Magikarp", "Gyarados", "Lapras", "Ditto", "Eevee", "Vaporeon", "Jolteon", "Flareon", "Porygon",
            "Omanyte", "Omastar", "Kabuto", "Kabutops", "Aerodactyl", "Snorlax", "Articuno", "Zapdos", "Moltres",
            "Dratini", "Dragonair", "Dragonite", "Mewtwo", "Mew",
            "Chikorita", "Bayleef", "Meganium", "Cyndaquil", "Quilava", "Typhlosion", "Totodile", "Croconaw", "Feraligatr",
            "Sentret", "Furret", "Hoothoot", "Noctowl", "Ledyba", "Ledian", "Spinarak", "Ariados", "Crobat", "Chinchou",
            "Lanturn", "Pichu", "Cleffa", "Igglybuff", "Togepi", "Togetic", "Natu", "Xatu", "Mareep", "Flaaffy",
            "Ampharos", "Bellossom", "Marill", "Azumarill", "Sudowoodo", "Politoed", "Hoppip", "Skiploom", "Jumpluff",
            "Aipom", "Sunkern", "Sunflora", "Yanma", "Wooper", "Quagsire", "Espeon", "Umbreon", "Murkrow", "Slowking",
            "Misdreavus", "Unown", "Wobbuffet", "Girafarig", "Pineco", "Forretress", "Dunsparce", "Gligar", "Steelix",
            "Snubbull", "Granbull", "Qwilfish", "Scizor", "Shuckle", "Heracross", "Sneasel", "Teddiursa", "Ursaring",
            "Slugma", "Magcargo", "Swinub", "Piloswine", "Corsola", "Remoraid", "Octillery", "Delibird", "Mantine",
            "Skarmory", "Houndour", "Houndoom", "Kingdra", "Phanpy", "Donphan", "Porygon2", "Stantler", "Smeargle",
            "Tyrogue", "Hitmontop", "Smoochum", "Elekid", "Magby", "Miltank", "Blissey", "Raikou", "Entei", "Suicune",
            "Larvitar", "Pupitar", "Tyranitar", "Lugia", "Ho-Oh", "Celebi",
            "Treecko", "Grovyle", "Sceptile", "Torchic", "Combusken", "Blaziken", "Mudkip", "Marshtomp", "Swampert",
            "Poochyena", "Mightyena", "Zigzagoon", "Linoone", "Wurmple", "Silcoon", "Beautifly", "Cascoon", "Dustox",
            "Lotad", "Lombre", "Ludicolo", "Seedot", "Nuzleaf", "Shiftry", "Taillow", "Swellow", "Wingull", "Pelipper",
            "Ralts", "Kirlia", "Gardevoir", "Surskit", "Masquerain", "Shroomish", "Breloom", "Slakoth", "Vigoroth",
            "Slaking", "Nincada", "Ninjask", "Shedinja", "Whismur", "Loudred", "Exploud", "Makuhita", "Hariyama",
            "Azurill", "Nosepass", "Skitty", "Delcatty", "Sableye", "Mawile", "Aron", "Lairon", "Aggron", "Meditite",
            "Medicham", "Electrike", "Manectric", "Plusle", "Minun", "Volbeat", "Illumise", "Roselia", "Gulpin",
            "Swalot", "Carvanha", "Sharpedo", "Wailmer", "Wailord", "Numel", "Camerupt", "Torkoal", "Spoink", "Grumpig",
            "Spinda", "Trapinch", "Vibrava", "Flygon", "Cacnea", "Cacturne", "Swablu", "Altaria", "Zangoose", "Seviper",
            "Lunatone", "Solrock", "Barboach", "Whiscash", "Corphish", "Crawdaunt", "Baltoy", "Claydol", "Lileep",
            "Cradily", "Anorith", "Armaldo", "Feebas", "Milotic", "Castform", "Kecleon", "Shuppet", "Banette", "Duskull",
            "Dusclops", "Tropius", "Chimecho", "Absol", "Wynaut", "Snorunt", "Glalie", "Spheal", "Sealeo", "Walrein",
            "Clamperl", "Huntail", "Gorebyss", "Relicanth", "Luvdisc", "Bagon", "Shelgon", "Salamence", "Beldum",
            "Metang", "Metagross", "Regirock", "Regice", "Registeel", "Latias", "Latios", "Kyogre", "Groudon",
            "Rayquaza", "Jirachi", "Deoxys",
            "Turtwig", "Grotle", "Torterra", "Chimchar", "Monferno", "Infernape", "Piplup", "Prinplup", "Empoleon",
            "Starly", "Staravia", "Staraptor", "Bidoof", "Bibarel", "Kricketot", "Kricketune", "Shinx", "Luxio",
            "Luxray", "Budew", "Roserade", "Cranidos", "Rampardos", "Shieldon", "Bastiodon", "Burmy", "Wormadam",
            "Mothim", "Combee", "Vespiquen", "Pachirisu", "Buizel", "Floatzel", "Cherubi", "Cherrim", "Shellos",
            "Gastrodon", "Ambipom", "Drifloon", "Drifblim", "Buneary", "Lopunny", "Mismagius", "Honchkrow", "Glameow",
            "Purugly", "Chingling", "Stunky", "Skuntank", "Bronzor", "Bronzong", "Bonsly", "Mime Jr.", "Happiny",
            "Chatot", "Spiritomb", "Gible", "Gabite", "Garchomp", "Munchlax", "Riolu", "Lucario", "Hippopotas",
            "Hippowdon", "Skorupi", "Drapion", "Croagunk", "Toxicroak", "Carnivine", "Finneon", "Lumineon", "Mantyke",
            "Snover", "Abomasnow", "Weavile", "Magnezone", "Lickilicky", "Rhyperior", "Tangrowth", "Electivire",
            "Magmortar", "Togekiss", "Yanmega", "Leafeon", "Glaceon", "Gliscor", "Mamoswine", "Porygon-Z", "Gallade",
            "Probopass", "Dusknoir", "Froslass", "Rotom", "Uxie", "Mesprit", "Azelf", "Dialga", "Palkia", "Heatran",
            "Regigigas", "Giratina", "Cresselia", "Phione", "Manaphy", "Darkrai", "Shaymin", "Arceus",
            "Victini", "Snivy", "Servine", "Serperior", "Tepig", "Pignite", "Emboar", "Oshawott", "Dewott", "Samurott",
            "Patrat", "Watchog", "Lillipup", "Herdier", "Stoutland", "Purrloin", "Liepard", "Pansage", "Simisage",
            "Pansear", "Simisear", "Panpour", "Simipour", "Munna", "Musharna", "Pidove", "Tranquill", "Unfezant",
            "Blitzle", "Zebstrika", "Roggenrola", "Boldore", "Gigalith", "Woobat", "Swoobat", "Drilbur", "Excadrill",
            "Audino", "Timburr", "Gurdurr", "Conkeldurr", "Tympole", "Palpitoad", "Seismitoad", "Throh", "Sawk",
            "Sewaddle", "Swadloon", "Leavanny", "Venipede", "Whirlipede", "Scolipede", "Cottonee", "Whimsicott",
            "Petilil", "Lilligant", "Basculin", "Sandile", "Krokorok", "Krookodile", "Darumaka", "Darmanitan",
            "Maractus", "Dwebble", "Crustle", "Scraggy", "Scrafty", "Sigilyph", "Yamask", "Cofagrigus", "Tirtouga",
            "Carracosta", "Archen", "Archeops", "Trubbish", "Garbodor", "Zorua", "Zoroark", "Minccino", "Cinccino",
            "Gothita", "Gothorita", "Gothitelle", "Solosis", "Duosion", "Reuniclus", "Ducklett", "Swanna", "Vanillite",
            "Vanillish", "Vanilluxe", "Deerling", "Sawsbuck", "Emolga", "Karrablast", "Escavalier", "Foongus",
            "Amoonguss", "Frillish", "Jellicent", "Alomomola", "Joltik", "Galvantula", "Ferroseed", "Ferrothorn",
            "Klink", "Klang", "Klinklang", "Tynamo", "Eelektrik", "Eelektross", "Elgyem", "Beheeyem", "Litwick",
            "Lampent", "Chandelure", "Axew", "Fraxure", "Haxorus", "Cubchoo", "Beartic", "Cryogonal", "Shelmet",
            "Accelgor", "Stunfisk", "Mienfoo", "Mienshao", "Druddigon", "Golett", "Golurk", "Pawniard", "Bisharp",
            "Bouffalant", "Rufflet", "Braviary", "Vullaby", "Mandibuzz", "Heatmor", "Durant", "Deino", "Zweilous",
            "Hydreigon", "Larvesta", "Volcarona", "Cobalion", "Terrakion", "Virizion", "Tornadus", "Thundurus",
            "Reshiram", "Zekrom", "Landorus", "Kyurem", "Keldeo", "Meloetta", "Genesect",
            "Chespin", "Quilladin", "Chesnaught", "Fennekin", "Braixen", "Delphox", "Froakie", "Frogadier", "Greninja",
            "Bunnelby", "Diggersby", "Fletchling", "Fletchinder", "Talonflame", "Scatterbug", "Spewpa", "Vivillon",
            "Litleo", "Pyroar", "Flabébé", "Floette", "Florges", "Skiddo", "Gogoat", "Pancham", "Pangoro", "Furfrou",
            "Espurr", "Meowstic", "Honedge", "Doublade", "Aegislash", "Spritzee", "Aromatisse", "Swirlix", "Slurpuff",
            "Inkay", "Malamar", "Binacle", "Barbaracle", "Skrelp", "Dragalge", "Clauncher", "Clawitzer", "Helioptile",
            "Heliolisk", "Tyrunt", "Tyrantrum", "Amaura", "Aurorus", "Sylveon", "Hawlucha", "Dedenne", "Carbink",
            "Goomy", "Sliggoo", "Goodra", "Klefki", "Phantump", "Trevenant", "Pumpkaboo", "Gourgeist", "Bergmite",
            "Avalugg", "Noibat", "Noivern", "Xerneas", "Yveltal", "Zygarde", "Diancie", "Hoopa", "Volcanion",
            "Rowlet", "Dartrix", "Decidueye", "Litten", "Torracat", "Incineroar", "Popplio", "Brionne", "Primarina",
            "Pikipek", "Trumbeak", "Toucannon", "Yungoos", "Gumshoos", "Grubbin", "Charjabug", "Vikavolt", "Crabrawler",
            "Crabominable", "Oricorio", "Cutiefly", "Ribombee", "Rockruff", "Lycanroc", "Wishiwashi", "Mareanie",
            "Toxapex", "Mudbray", "Mudsdale", "Dewpider", "Araquanid", "Fomantis", "Lurantis", "Morelull", "Shiinotic",
            "Salandit", "Salazzle", "Stufful", "Bewear", "Bounsweet", "Steenee", "Tsareena", "Comfey", "Oranguru",
            "Passimian", "Wimpod", "Golisopod", "Sandygast", "Palossand", "Pyukumuku", "Type: Null", "Silvally",
            "Minior", "Komala", "Turtonator", "Togedemaru", "Mimikyu", "Bruxish", "Drampa", "Dhelmise", "Jangmo-o",
            "Hakamo-o", "Kommo-o", "Tapu Koko", "Tapu Lele", "Tapu Bulu", "Tapu Fini", "Cosmog", "Cosmoem", "Solgaleo",
            "Lunala", "Nihilego", "Buzzwole", "Pheromosa", "Xurkitree", "Celesteela", "Kartana", "Guzzlord",
            "Necrozma", "Magearna", "Marshadow", "Poipole", "Naganadel", "Stakataka", "Blacephalon", "Zeraora",
            "Meltan", "Melmetal",
            "Grookey", "Thwackey", "Rillaboom", "Scorbunny", "Raboot", "Cinderace", "Sobble", "Drizzile", "Inteleon",
            "Skwovet", "Greedent", "Rookidee", "Corvisquire", "Corviknight", "Blipbug", "Dottler", "Orbeetle",
            "Nickit", "Thievul", "Gossifleur", "Eldegoss", "Wooloo", "Dubwool", "Chewtle", "Drednaw", "Yamper",
            "Boltund", "Rolycoly", "Carkol", "Coalossal", "Applin", "Flapple", "Appletun", "Silicobra", "Sandaconda",
            "Cramorant", "Arrokuda", "Barraskewda", "Toxel", "Toxtricity", "Sizzlipede", "Centiskorch", "Clobbopus",
            "Grapploct", "Sinistea", "Polteageist", "Hatenna", "Hattrem", "Hatterene", "Impidimp", "Morgrem",
            "Grimmsnarl", "Obstagoon", "Perrserker", "Cursola", "Sirfetch'd", "Mr. Rime", "Runerigus", "Milcery",
            "Alcremie", "Falinks", "Pincurchin", "Snom", "Frosmoth", "Stonjourner", "Eiscue", "Indeedee", "Morpeko",
            "Cufant", "Copperajah", "Dracozolt", "Arctozolt", "Dracovish", "Arctovish", "Duraludon", "Dreepy",
            "Drakloak", "Dragapult", "Zacian", "Zamazenta", "Eternatus", "Kubfu", "Urshifu", "Zarude", "Regieleki",
            "Regidrago", "Glastrier", "Spectrier", "Calyrex", "Wyrdeer", "Kleavor", "Ursaluna", "Basculegion",
            "Sneasler", "Overqwil", "Enamorus",
            "Sprigatito", "Floragato", "Meowscarada", "Fuecoco", "Crocalor", "Skeledirge", "Quaxly", "Quaxwell", "Quaquaval",
            "Lechonk", "Oinkologne", "Tarountula", "Spidops", "Nymble", "Lokix", "Pawmi", "Pawmo", "Pawmot", "Tandemaus",
            "Maushold", "Fidough", "Dachsbun", "Smoliv", "Dolliv", "Arboliva", "Squawkabilly", "Nacli", "Naclstack",
            "Garganacl", "Charcadet", "Armarouge", "Ceruledge", "Tadbulb", "Bellibolt", "Wattrel", "Kilowattrel",
            "Maschiff", "Mabosstiff", "Shroodle", "Grafaiai", "Bramblin", "Brambleghast", "Toedscool", "Toedscruel",
            "Klawf", "Capsakid", "Scovillain", "Rellor", "Rabsca", "Flittle", "Espathra", "Tinkatink", "Tinkatuff",
            "Tinkaton", "Wiglett", "Wugtrio", "Bombirdier", "Finizen", "Palafin", "Varoom", "Revavroom", "Cyclizar",
            "Orthworm", "Glimmet", "Glimmora", "Greavard", "Houndstone", "Flamigo", "Cetoddle", "Cetitan", "Veluza",
            "Dondozo", "Tatsugiri", "Annihilape", "Clodsire", "Farigiraf", "Dudunsparce", "Kingambit", "Great Tusk",
            "Scream Tail", "Brute Bonnet", "Flutter Mane", "Slither Wing", "Sandy Shocks", "Iron Treads", "Iron Bundle",
            "Iron Hands", "Iron Jugulis", "Iron Moth", "Iron Thorns", "Frigibax", "Arctibax", "Baxcalibur", "Gimmighoul",
            "Gholdengo", "Wo-Chien", "Chien-Pao", "Ting-Lu", "Chi-Yu", "Roaring Moon", "Iron Valiant", "Koraidon",
            "Miraidon", "Walking Wake", "Iron Leaves", "Pecharunt", "Okidogi", "Munkidori", "Fezandipiti", "Terapagos"
        ].sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));
        // --- END FULL LIST ---

        let setNames = [];

        // --- Function to Fetch Set Names 
        async function fetchSetNames() {
            const setsApiUrl = 'https://api.pokemontcg.io/v2/sets?select=name&orderBy=releaseDate';
            try {
                const response = await fetch(setsApiUrl);
                if (!response.ok) throw new Error(`Failed to fetch sets: ${response.status}`);
                const data = await response.json();
                setNames = data.data.map(set => set.name).sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));
                console.log(`Loaded ${setNames.length} set names.`);
            } catch (error) {
                console.error("Error fetching set names:", error);
                setNames = [];
            }
        }

        // --- Function to Show/Hide Suggestions 
        function displaySuggestions(inputText, suggestionsList, targetInput, targetContainer) {
            targetContainer.innerHTML = '';
            if (inputText.length < 1 || suggestionsList.length === 0) {
                targetContainer.style.display = 'none';
                return;
            }
            const filtered = suggestionsList.filter(suggestion =>
                suggestion.toLowerCase().startsWith(inputText.toLowerCase())
            );
            if (filtered.length === 0) {
                targetContainer.style.display = 'none';
                return;
            }
            filtered.slice(0, 8).forEach(suggestion => {
                const item = document.createElement('div');
                item.classList.add('suggestion-item');
                item.textContent = suggestion;
                item.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    targetInput.value = suggestion;
                    targetContainer.style.display = 'none';
                });
                targetContainer.appendChild(item);
            });
            targetContainer.style.display = 'block';
        }

        // --- Hide Specific Suggestion Container 
        function hideSuggestions(container) {
             if (container) container.style.display = 'none';
        }
        // --- Hide ALL Suggestion Containers 
        function hideAllSuggestions() {
             hideSuggestions(pokemonSuggestionsContainer);
             hideSuggestions(setSuggestionsContainer);
        }


        // --- Theme Handling ---
        const THEME_STORAGE_KEY = 'pokemonTcgDexTheme';
        const DEFAULT_THEME = 'eevee';

        function applyTheme(themeName) {
            document.body.classList.remove('theme-eevee', 'theme-gengar', 'theme-dragonite', 'theme-charizard', 'theme-pikachu');
            document.body.classList.add(`theme-${themeName}`);
            themeButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.theme === themeName);
            });
            try {
                localStorage.setItem(THEME_STORAGE_KEY, themeName);
            } catch (e) {
                console.warn("Could not save theme preference to localStorage.", e);
            }
            console.log(`Theme applied: ${themeName}`);
        }

        function loadTheme() {
            let savedTheme = DEFAULT_THEME;
             try {
                 const storedTheme = localStorage.getItem(THEME_STORAGE_KEY);
                 if (storedTheme && ['eevee', 'gengar', 'dragonite', 'charizard', 'pikachu'].includes(storedTheme)) {
                    savedTheme = storedTheme;
                 }
             } catch (e) {
                 console.warn("Could not load theme preference from localStorage.", e);
             }
            applyTheme(savedTheme);
        }

        // Add event listeners to theme buttons
         themeButtons.forEach(button => {
             button.addEventListener('click', () => {
                 const theme = button.dataset.theme;
                 if (theme) {
                     applyTheme(theme);
                 }
             });
         });


        // --- Initial Setup 
        document.addEventListener('DOMContentLoaded', () => {
            showInitialMessage();
            fetchSetNames();
            loadTheme();
        });

        // --- showInitialMessage 
        function showInitialMessage() {
             resultsDiv.innerHTML = '<p class="message">Enter a Pokémon name and/or Set name to find TCG cards!</p>';
             resultsDiv.classList.add('results-placeholder');
             loader.style.display = 'none';
             clearPagination();
             hideAllSuggestions();
         }

        // --- fetchCards function 
        async function fetchCards(pokemonName, setName, rarity, page = 1) {
             currentPokemonName = pokemonName.trim(); currentSetName = setName.trim(); currentRarity = rarity; currentPage = page; hideAllSuggestions(); resultsDiv.classList.remove('results-placeholder'); if (!currentPokemonName && !currentSetName) { resultsDiv.innerHTML = '<p class="message error">Please enter a Pokémon Name or Set Name.</p>'; clearPagination(); loader.style.display = 'none'; return; } if (currentAbortController) currentAbortController.abort(); currentAbortController = new AbortController(); const signal = currentAbortController.signal; resultsDiv.innerHTML = ''; clearPagination(); loader.style.display = 'block'; let queryParts = []; if (currentPokemonName) queryParts.push(`name:"${currentPokemonName.replace(/"/g, '\\"')}*"`); if (currentSetName) queryParts.push(`set.name:"${currentSetName.replace(/"/g, '\\"')}*"`); if (currentRarity) queryParts.push(`rarity:"${currentRarity.replace(/"/g, '\\"')}"`); const query = queryParts.join(' '); const apiUrl = `https://api.pokemontcg.io/v2/cards?q=${encodeURIComponent(query)}&orderBy=set.releaseDate,name&page=${page}&pageSize=${pageSize}`; try { const response = await fetch(apiUrl, { signal }); if (!response.ok) { let e = `API error (${response.status})`; try { e += `: ${ (await response.json()).error.message }`; } catch { e += `. ${response.statusText}`; } throw new Error(e); } const data = await response.json(); loader.style.display = 'none'; if (!data.data || data.data.length === 0) { let m = "No cards found"; if (currentPokemonName) m += ` matching "${currentPokemonName}"`; if (currentSetName) m += ` in set "${currentSetName}"`; if (currentRarity) m += ` with rarity "${currentRarity}"`; m += ". Try a different search!"; resultsDiv.innerHTML = `<p class="message">${m}</p>`; totalPages = 1; } else { totalPages = Math.ceil(data.totalCount / data.pageSize); displayCards(data.data); } renderPaginationControls(); if (page > 1) document.getElementById('container')?.scrollIntoView({ behavior: 'smooth', block: 'start' }); } catch (error) { loader.style.display = 'none'; clearPagination(); resultsDiv.classList.remove('results-placeholder'); if (error.name === 'AbortError') { console.log('Fetch aborted'); showInitialMessage(); } else { console.error("Error fetching cards:", error); resultsDiv.innerHTML = `<p class="message error">Error: ${error.message}. Please check the term or API status.</p>`; } } finally { if (loader.style.display === 'block') loader.style.display = 'none'; if (!resultsDiv.classList.contains('results-placeholder')) { const i = resultsDiv.querySelector('p.message'); if (!i || !i.textContent.startsWith('Enter a Pokémon name')) { resultsDiv.classList.remove('results-placeholder'); } } currentAbortController = null; }
          }

        // --- displayCards function 
        function displayCards(cards) {
              resultsDiv.classList.remove('results-placeholder'); if (!cards || cards.length === 0) return; cards.forEach(card => { if (card.images?.small && card.name && card.set?.name) { const cardContainer = document.createElement('div'); cardContainer.classList.add('card-container'); const img = document.createElement('img'); img.src = card.images.small; img.alt = `Card: ${card.name} - Set: ${card.set.name}`; img.title = `Click to enlarge\nName: ${card.name}\nSet: ${card.set.name}\nRarity: ${card.rarity || 'N/A'}`; img.classList.add('card-image'); img.loading = 'lazy'; img.addEventListener('click', () => openModal(card.images.large)); const infoDiv = document.createElement('div'); infoDiv.classList.add('card-info'); let marketLinkHTML = ''; if (card.tcgplayer && card.tcgplayer.url) { const affiliateUrl = card.tcgplayer.url; marketLinkHTML = `<a href="${affiliateUrl}" class="market-link" target="_blank" rel="noopener noreferrer" title="View ${card.name} from ${card.set.name} on TCGplayer">View on TCGplayer</a>`; } infoDiv.innerHTML = `<strong>${card.set.name}</strong><span>Rarity: ${card.rarity || 'Common'}</span>${marketLinkHTML}`; cardContainer.appendChild(img); cardContainer.appendChild(infoDiv); resultsDiv.appendChild(cardContainer); } else { console.warn("Skipping card due to missing data:", card.id, card.name, card.set?.name, card.images?.small); } });
          }

        // --- renderPaginationControls function 
          function renderPaginationControls() {
             paginationControlsDiv.innerHTML = ''; if (totalPages <= 1) return; const prevButton = document.createElement('button'); prevButton.textContent = '← Previous'; prevButton.classList.add('pagination-button'); prevButton.disabled = (currentPage === 1); prevButton.setAttribute('aria-label', 'Go to previous page'); prevButton.addEventListener('click', () => { if (currentPage > 1) fetchCards(currentPokemonName, currentSetName, currentRarity, currentPage - 1); }); const pageInfo = document.createElement('span'); pageInfo.id = 'page-info'; pageInfo.textContent = `Page ${currentPage} of ${totalPages}`; const nextButton = document.createElement('button'); nextButton.textContent = 'Next →'; nextButton.classList.add('pagination-button'); nextButton.disabled = (currentPage >= totalPages); nextButton.setAttribute('aria-label', 'Go to next page'); nextButton.addEventListener('click', () => { if (currentPage < totalPages) fetchCards(currentPokemonName, currentSetName, currentRarity, currentPage + 1); }); paginationControlsDiv.appendChild(prevButton); paginationControlsDiv.appendChild(pageInfo); paginationControlsDiv.appendChild(nextButton);
         }

        function clearPagination() { paginationControlsDiv.innerHTML = ''; }

        // --- Modal Functions ---
        function openModal(imageUrl) { if (imageUrl) { modalImage.src = imageUrl; modal.style.display = "block"; document.body.style.overflow = 'hidden'; } }
        function closeModal() { modal.style.display = "none"; modalImage.src = ""; document.body.style.overflow = ''; }

        // --- Event Listeners ---
        searchButton.addEventListener('click', () => { const nameTerm = pokemonNameInput.value; const setTerm = setNameInput.value; const rarityTerm = raritySelect.value; hideAllSuggestions(); fetchCards(nameTerm, setTerm, rarityTerm, 1); });
        pokemonNameInput.addEventListener('keypress', handleEnterKey); setNameInput.addEventListener('keypress', handleEnterKey); raritySelect.addEventListener('keypress', handleEnterKey);
        function handleEnterKey(event) { if (event.key === 'Enter') { event.preventDefault(); const nameTerm = pokemonNameInput.value; const setTerm = setNameInput.value; const rarityTerm = raritySelect.value; hideAllSuggestions(); fetchCards(nameTerm, setTerm, rarityTerm, 1); } }

        // --- Autocomplete Event Listeners 
        pokemonNameInput.addEventListener('input', () => { displaySuggestions(pokemonNameInput.value.trim(), pokemonNames, pokemonNameInput, pokemonSuggestionsContainer); hideSuggestions(setSuggestionsContainer); });
        setNameInput.addEventListener('input', () => { displaySuggestions(setNameInput.value.trim(), setNames, setNameInput, setSuggestionsContainer); hideSuggestions(pokemonSuggestionsContainer); });
        document.addEventListener('click', (event) => { if (!pokemonNameInput.contains(event.target) && !pokemonSuggestionsContainer.contains(event.target)) hideSuggestions(pokemonSuggestionsContainer); if (!setNameInput.contains(event.target) && !setSuggestionsContainer.contains(event.target)) hideSuggestions(setSuggestionsContainer); });
        pokemonNameInput.addEventListener('blur', () => { setTimeout(() => { if (!pokemonSuggestionsContainer.contains(document.activeElement)) hideSuggestions(pokemonSuggestionsContainer); }, 150); });
        setNameInput.addEventListener('blur', () => { setTimeout(() => { if (!setSuggestionsContainer.contains(document.activeElement)) hideSuggestions(setSuggestionsContainer); }, 150); });
        pokemonNameInput.addEventListener('keydown', (event) => { if (event.key === 'Escape') hideSuggestions(pokemonSuggestionsContainer); });
        setNameInput.addEventListener('keydown', (event) => { if (event.key === 'Escape') hideSuggestions(setSuggestionsContainer); });

        // --- Modal Event Listeners 
        closeModalSpan.addEventListener('click', closeModal); modal.addEventListener('click', (event) => { if (event.target === modal) closeModal(); }); window.addEventListener('keydown', (event) => { if (event.key === 'Escape' && modal.style.display === 'block') closeModal(); });

        // --- Footer Credits Function 
        function addFooterCredits() { if(footerElement) { const currentYear = new Date().getFullYear(); footerElement.innerHTML = `Made with <span class="heart">❤️</span> by <span class="creator-name">Amadou</span> © ${currentYear}. Happy Collecting! <br> Card data powered by <a href="https://pokemontcg.io/" target="_blank" rel="noopener noreferrer">pokemontcg.io API</a>. Market links go to TCGplayer.com.`; } else { console.warn("Footer element (#page-footer) not found."); } }
        addFooterCredits();

    </script>

</body>
</html>