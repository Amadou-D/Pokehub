<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokémon TCG Dex</title>

    <!-- === Favicon Link === -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <!-- === End Favicon Link === -->

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --pokemon-red: #FF0000;
            --pokemon-blue: #3B4CCA;
            --pokemon-yellow: #FFDE00;
            --dark-charcoal: #333333;
            --medium-grey: #666666;
            --light-grey: #f0f0f0;
            --white: #ffffff;
            --border-radius: 8px;
            --card-width: 245px;
            --market-color: #ffba00;
            --market-color-hover: #e6a800;
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Lato', sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark-charcoal);
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #container {
            width: 100%;
            max-width: 1200px;
            margin: 30px 0;
            background: var(--white);
            padding: 30px 40px;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 60px);
        }
        #container:hover {
             box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        main {
           flex-grow: 1;
           position: relative;
        }

        h1 {
            font-family: 'Press Start 2P', cursive;
            text-align: center;
            color: var(--pokemon-red);
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            margin-bottom: 35px;
            text-shadow: 2px 2px var(--pokemon-yellow);
        }

        /* --- Updated Search Controls Styling --- */
        #search-controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start; /* Align labels to the top */
            margin-bottom: 40px;
            gap: 20px; /* Spacing between field groups and button */
        }

        .search-field-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            position: relative; /* Needed for suggestion positioning */
            width: 240px; /* Match input width */
        }

        #search-controls label {
            font-weight: bold;
            color: var(--medium-grey);
            font-size: 0.9rem;
            text-align: left;
            margin-left: 3px;
        }

        #pokemonNameInput,
        #setNameInput {
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: border-color 0.3s ease;
            outline: none;
            width: 100%; /* Take full width of parent group */
            /* Ensure input is above suggestions */
            position: relative;
            z-index: 102;
        }
        #pokemonNameInput:focus,
        #setNameInput:focus {
            border-color: var(--pokemon-blue);
        }

        #searchButton {
            padding: 12px 25px;
            background-color: var(--pokemon-blue);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: background-color 0.3s ease;
            white-space: nowrap;
            height: 47px;
            align-self: flex-end; /* Align button with bottom of inputs */
             /* Ensure button clickable */
            position: relative;
            z-index: 102;
            margin-top: 24px; /* Add margin to align with inputs when labels wrap */
        }
        #searchButton:hover {
            background-color: var(--pokemon-yellow);
            color: var(--dark-charcoal);
        }
        /* --- End Updated Search Controls Styling --- */

         /* --- Autocomplete Suggestions Styling (for both inputs) --- */
        .suggestions-container {
            display: none; /* Hidden by default */
            position: absolute;
            top: 100%; /* Position below the input */
            left: 0;
            right: 0;
            max-height: 200px; /* Slightly reduced height */
            overflow-y: auto;
            background-color: var(--white);
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            z-index: 101; /* Below input/button, above other content */
            margin-top: -2px; /* Overlap input border */
            /* Improve scrollbar appearance */
             scrollbar-width: thin;
             scrollbar-color: var(--medium-grey) var(--light-grey);
        }
         /* Webkit Scrollbar */
         .suggestions-container::-webkit-scrollbar {
             width: 8px;
         }
         .suggestions-container::-webkit-scrollbar-track {
             background: var(--light-grey);
             border-radius: 0 0 var(--border-radius) 0;
         }
         .suggestions-container::-webkit-scrollbar-thumb {
             background-color: var(--medium-grey);
             border-radius: 4px;
             border: 2px solid var(--light-grey);
         }


        .suggestion-item {
            padding: 8px 12px; /* Slightly smaller padding */
            font-size: 0.9rem;
            color: var(--dark-charcoal);
            cursor: pointer;
            border-bottom: 1px solid var(--light-grey);
            background-color: var(--white);
             transition: background-color 0.15s ease;
             white-space: nowrap; /* Prevent wrapping */
             overflow: hidden;
             text-overflow: ellipsis;
        }
        .suggestion-item:last-child {
            border-bottom: none;
        }
        .suggestion-item:hover,
        .suggestion-item.active {
            background-color: var(--light-grey);
            color: var(--pokemon-blue);
        }
        /* --- End Autocomplete Styling --- */


        /* --- Loader Styling (Position Fixed) --- */
        #loader {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 4px solid var(--dark-charcoal);
            background: linear-gradient(to bottom, var(--pokemon-red) 0%, var(--pokemon-red) 48%, var(--dark-charcoal) 48%, var(--dark-charcoal) 52%, var(--white) 52%, var(--white) 100%);
            animation: spin 1s linear infinite;
            box-shadow: inset 0 0 0 4px var(--dark-charcoal), 0 0 10px rgba(0,0,0,0.2);
            z-index: 1001;
        }
        #loader::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 18px;
            height: 18px;
            background-color: var(--white);
            border: 4px solid var(--dark-charcoal);
            border-radius: 50%;
            z-index: 1;
        }
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        /* --- End Loader Styling --- */

        /* --- Placeholder Background Style --- */
        #results.results-placeholder {
            background-image: linear-gradient(rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.6)), url('https://assets.pokemon.com/assets/cms2/img/misc/virtual-backgrounds/masters/forest.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: var(--border-radius);
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-image 0.5s ease-in-out;
            padding-top: 0;
        }

        #results.results-placeholder .message {
            background-color: rgba(0, 0, 0, 0.6);
            color: var(--white);
            padding: 15px 25px;
            border-radius: var(--border-radius);
            font-style: normal;
            font-size: 1.2rem;
            max-width: 80%;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            width: auto;
            text-align: center;
        }
        /* --- End Placeholder Background Style --- */

        #results {
            margin-top: 30px;
            border-top: 1px solid #eee;
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            justify-content: center;
            position: relative;
            transition: background-image 0.5s ease-in-out;
        }
        #results:not(.results-placeholder) {
            padding-top: 30px;
            min-height: 150px;
        }

        #results .message:not(.results-placeholder .message) {
             width: 100%; text-align: center; font-size: 1.1rem; color: var(--medium-grey); padding: 30px 15px; font-style: italic;
             background-color: transparent;
             box-shadow: none;
        }
         #results .error {
             color: var(--pokemon-red); font-weight: bold; font-style: normal; background-color: #ffebeb; border: 1px solid var(--pokemon-red); border-radius: var(--border-radius);
             color: var(--pokemon-red) !important;
             padding: 30px 15px;
             width: 100%;
         }


        /* Card styling */
        .card-container {
            background-color: var(--white);
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            width: var(--card-width);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .card-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        .card-image {
            display: block;
            width: 100%;
            height: auto;
            max-height: 340px;
            object-fit: contain;
            background-color: #eee;
            cursor: pointer;
        }
        .card-info {
            padding: 12px 15px;
            font-size: 0.85rem;
            text-align: center;
            background-color: #f9f9f9;
            border-top: 1px solid #eee;
            margin-top: auto;
        }
        .card-info strong {
            color: var(--pokemon-blue);
            display: block;
            margin-bottom: 4px;
            font-size: 0.9rem;
        }
        .card-info span {
            color: var(--medium-grey);
            display: block;
            margin-bottom: 8px;
        }

        /* Market Link Button Styling */
        .market-link {
            display: inline-block;
            margin-top: 5px;
            padding: 6px 12px;
            font-size: 0.8rem;
            font-weight: bold;
            color: var(--dark-charcoal);
            background-color: var(--market-color);
            border: none;
            border-radius: 5px;
            text-decoration: none;
            transition: background-color 0.2s ease, transform 0.1s ease;
            cursor: pointer;
        }
        .market-link:hover {
            background-color: var(--market-color-hover);
            transform: translateY(-1px);
            color: var(--dark-charcoal);
        }
        .market-link:active {
             transform: translateY(0px);
        }

        /* Pagination Styling */
        #pagination-controls { display: flex; justify-content: center; align-items: center; padding: 25px 0 10px 0; margin-top: 20px; gap: 15px; width: 100%; }
        .pagination-button { padding: 8px 16px; background-color: var(--pokemon-blue); color: white; border: none; border-radius: var(--border-radius); cursor: pointer; font-size: 0.9rem; font-weight: bold; transition: background-color 0.3s ease, opacity 0.3s ease; }
        .pagination-button:hover:not(:disabled) { background-color: var(--pokemon-yellow); color: var(--dark-charcoal); }
        .pagination-button:disabled { background-color: #ccc; cursor: not-allowed; opacity: 0.6; }
        #page-info { font-size: 1rem; color: var(--medium-grey); font-weight: bold; }

        /* Modal Styling */
        #modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.8); cursor: pointer; padding-top: 50px; }
        #modal-content { margin: auto; display: block; width: 80%; max-width: 350px; cursor: default; }
        #modal-image { width: 100%; height: auto; border-radius: 15px; }
        #close-modal { position: absolute; top: 15px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; transition: 0.3s; cursor: pointer; user-select: none; }
        #close-modal:hover, #close-modal:focus { color: var(--pokemon-yellow); text-decoration: none; }

        /* Footer Styling */
        .page-footer { width: 100%; text-align: center; margin-top: auto; padding-top: 20px; border-top: 1px solid #eee; font-size: 0.9rem; color: var(--medium-grey); }
        .page-footer a { color: var(--pokemon-blue); text-decoration: none; transition: color 0.2s ease; }
        .page-footer a:hover { color: var(--pokemon-red); }
        .page-footer .heart { color: var(--pokemon-red); display: inline-block; animation: pulse 1.5s infinite ease-in-out; }
        .page-footer .creator-name { font-weight: bold; color: var(--dark-charcoal); }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }

        /* Responsive Media Queries */
        /* Responsive Media Queries */
        @media (max-width: 650px) { /* Adjusted breakpoint */
            #search-controls {
                flex-direction: column;
                align-items: center; /* Center items vertically */
                gap: 15px; /* Consistent gap */
            }
             .search-field-group {
                 width: 90%;
                 max-width: 400px;
                 /* Ensure group itself doesn't interfere with centering */
                 display: flex; /* Already set, but confirming */
                 flex-direction: column; /* Already set */
                 align-items: center; /* Center label and input within the group */
             }
             #pokemonNameInput,
             #setNameInput {
                 width: 100%; /* Full width of group */
                 text-align: center;
            }
             /* Suggestions positioning on mobile */
             .suggestions-container {
                 position: relative;
                 top: auto;
                 left: auto;
                 right: auto;
                 width: 100%;
                 margin-top: 2px;
                 border-radius: var(--border-radius);
                 border: 1px solid #ddd;
                 max-height: 150px;
            }

             /* --- FIX FOR BUTTON CENTERING --- */
             #searchButton {
                 width: 90%;
                 max-width: 400px;
                 /* Reset alignment to follow parent's center alignment */
                 align-self: auto;
                 /* Adjust top margin for better vertical spacing when stacked */
                 margin-top: 10px; /* Use a smaller margin than the desktop version */
            }
             /* --- END FIX --- */

             #search-controls label {
                 text-align: center;
                 margin-left: 0;
             }
        }
        @media (max-width: 600px) {
            body { padding: 10px; }
            #container { padding: 20px; margin: 15px 0; min-height: calc(100vh - 30px); }
            h1 { font-size: 1.6rem; text-shadow: 1px 1px var(--pokemon-yellow); }
             #results.results-placeholder { min-height: 250px; }
            #results { gap: 15px; }
            .card-container { width: calc(50% - 10px); }
            #modal-content { max-width: 300px; }
            #pagination-controls { gap: 10px; }
            .pagination-button { padding: 6px 12px; font-size: 0.8rem; }
            #page-info { font-size: 0.9rem; }
            .card-image { max-height: 280px; }
        }
        @media (max-width: 400px) {
             #results.results-placeholder { min-height: 200px; }
             #results.results-placeholder .message { font-size: 1rem; padding: 10px 15px; }
            .card-container { width: calc(100% - 10px); }
            .card-image { max-height: 400px; }
        }

    </style>
</head>
<body>

    <div id="container">
        <main>
            <h1>Pokémon TCG Dex</h1>

             <!-- === Updated Search Controls HTML with Suggestion Containers === -->
            <div id="search-controls">
                <div class="search-field-group">
                    <label for="pokemonNameInput">Pokémon Name:</label>
                    <input type="text" id="pokemonNameInput" placeholder="e.g., Pikachu" autocomplete="off">
                    <div id="pokemon-suggestions-container" class="suggestions-container"></div>
                </div>
                <div class="search-field-group">
                    <label for="setNameInput">Set Name:</label>
                    <input type="text" id="setNameInput" placeholder="e.g., Base Set" autocomplete="off">
                    <div id="set-suggestions-container" class="suggestions-container"></div>
                </div>
                <button id="searchButton">Search</button>
            </div>
            <!-- === End Updated Search Controls HTML === -->

            <!-- Loader -->
            <div id="loader"></div>

            <div id="results">
                 <!-- Initial message set by JS -->
            </div>

             <div id="pagination-controls"></div>

        </main>

        <footer class="page-footer" id="page-footer"></footer>
    </div>

    <!-- Modal -->
    <div id="modal">
      <span id="close-modal" title="Close">×</span>
      <div id="modal-content">
        <img id="modal-image" src="" alt="Large Card Image">
      </div>
    </div>

    <script>
        // --- Element References (Updated) ---
        const pokemonNameInput = document.getElementById('pokemonNameInput');
        const setNameInput = document.getElementById('setNameInput');
        const searchButton = document.getElementById('searchButton');
        const resultsDiv = document.getElementById('results');
        const loader = document.getElementById('loader');
        const modal = document.getElementById('modal');
        const modalImage = document.getElementById('modal-image');
        const closeModalSpan = document.getElementById('close-modal');
        const footerElement = document.getElementById('page-footer');
        const paginationControlsDiv = document.getElementById('pagination-controls');
        const pokemonSuggestionsContainer = document.getElementById('pokemon-suggestions-container'); // Specific container
        const setSuggestionsContainer = document.getElementById('set-suggestions-container');       // Specific container
        let currentAbortController = null;

        let currentPage = 1;
        let totalPages = 1;
        let currentPokemonName = '';
        let currentSetName = '';
        const pageSize = 60;

        // --- Autocomplete Data ---
        // ***** THIS IS THE UPDATED, MUCH LONGER LIST *****
        const pokemonNames = [
            // Gen 1
            "Bulbasaur", "Ivysaur", "Venusaur", "Charmander", "Charmeleon", "Charizard", "Squirtle", "Wartortle", "Blastoise",
            "Caterpie", "Metapod", "Butterfree", "Weedle", "Kakuna", "Beedrill", "Pidgey", "Pidgeotto", "Pidgeot",
            "Rattata", "Raticate", "Spearow", "Fearow", "Ekans", "Arbok", "Pikachu", "Raichu", "Sandshrew", "Sandslash",
            "Nidoran♀", "Nidorina", "Nidoqueen", "Nidoran♂", "Nidorino", "Nidoking", "Clefairy", "Clefable", "Vulpix",
            "Ninetales", "Jigglypuff", "Wigglytuff", "Zubat", "Golbat", "Oddish", "Gloom", "Vileplume", "Paras",
            "Parasect", "Venonat", "Venomoth", "Diglett", "Dugtrio", "Meowth", "Persian", "Psyduck", "Golduck",
            "Mankey", "Primeape", "Growlithe", "Arcanine", "Poliwag", "Poliwhirl", "Poliwrath", "Abra", "Kadabra",
            "Alakazam", "Machop", "Machoke", "Machamp", "Bellsprout", "Weepinbell", "Victreebel", "Tentacool",
            "Tentacruel", "Geodude", "Graveler", "Golem", "Ponyta", "Rapidash", "Slowpoke", "Slowbro", "Magnemite",
            "Magneton", "Farfetch'd", "Doduo", "Dodrio", "Seel", "Dewgong", "Grimer", "Muk", "Shellder", "Cloyster",
            "Gastly", "Haunter", "Gengar", "Onix", "Drowzee", "Hypno", "Krabby", "Kingler", "Voltorb", "Electrode",
            "Exeggcute", "Exeggutor", "Cubone", "Marowak", "Hitmonlee", "Hitmonchan", "Lickitung", "Koffing",
            "Weezing", "Rhyhorn", "Rhydon", "Chansey", "Tangela", "Kangaskhan", "Horsea", "Seadra", "Goldeen",
            "Seaking", "Staryu", "Starmie", "Mr. Mime", "Scyther", "Jynx", "Electabuzz", "Magmar", "Pinsir", "Tauros",
            "Magikarp", "Gyarados", "Lapras", "Ditto", "Eevee", "Vaporeon", "Jolteon", "Flareon", "Porygon",
            "Omanyte", "Omastar", "Kabuto", "Kabutops", "Aerodactyl", "Snorlax", "Articuno", "Zapdos", "Moltres",
            "Dratini", "Dragonair", "Dragonite", "Mewtwo", "Mew",
            // Gen 2
            "Chikorita", "Bayleef", "Meganium", "Cyndaquil", "Quilava", "Typhlosion", "Totodile", "Croconaw", "Feraligatr",
            "Sentret", "Furret", "Hoothoot", "Noctowl", "Ledyba", "Ledian", "Spinarak", "Ariados", "Crobat", "Chinchou",
            "Lanturn", "Pichu", "Cleffa", "Igglybuff", "Togepi", "Togetic", "Natu", "Xatu", "Mareep", "Flaaffy",
            "Ampharos", "Bellossom", "Marill", "Azumarill", "Sudowoodo", "Politoed", "Hoppip", "Skiploom", "Jumpluff",
            "Aipom", "Sunkern", "Sunflora", "Yanma", "Wooper", "Quagsire", "Espeon", "Umbreon", "Murkrow", "Slowking",
            "Misdreavus", "Unown", "Wobbuffet", "Girafarig", "Pineco", "Forretress", "Dunsparce", "Gligar", "Steelix",
            "Snubbull", "Granbull", "Qwilfish", "Scizor", "Shuckle", "Heracross", "Sneasel", "Teddiursa", "Ursaring",
            "Slugma", "Magcargo", "Swinub", "Piloswine", "Corsola", "Remoraid", "Octillery", "Delibird", "Mantine",
            "Skarmory", "Houndour", "Houndoom", "Kingdra", "Phanpy", "Donphan", "Porygon2", "Stantler", "Smeargle",
            "Tyrogue", "Hitmontop", "Smoochum", "Elekid", "Magby", "Miltank", "Blissey", "Raikou", "Entei", "Suicune",
            "Larvitar", "Pupitar", "Tyranitar", "Lugia", "Ho-Oh", "Celebi",
            // Gen 3
            "Treecko", "Grovyle", "Sceptile", "Torchic", "Combusken", "Blaziken", "Mudkip", "Marshtomp", "Swampert",
            "Poochyena", "Mightyena", "Zigzagoon", "Linoone", "Wurmple", "Silcoon", "Beautifly", "Cascoon", "Dustox",
            "Lotad", "Lombre", "Ludicolo", "Seedot", "Nuzleaf", "Shiftry", "Taillow", "Swellow", "Wingull", "Pelipper",
            "Ralts", "Kirlia", "Gardevoir", "Surskit", "Masquerain", "Shroomish", "Breloom", "Slakoth", "Vigoroth",
            "Slaking", "Nincada", "Ninjask", "Shedinja", "Whismur", "Loudred", "Exploud", "Makuhita", "Hariyama",
            "Azurill", "Nosepass", "Skitty", "Delcatty", "Sableye", "Mawile", "Aron", "Lairon", "Aggron", "Meditite",
            "Medicham", "Electrike", "Manectric", "Plusle", "Minun", "Volbeat", "Illumise", "Roselia", "Gulpin",
            "Swalot", "Carvanha", "Sharpedo", "Wailmer", "Wailord", "Numel", "Camerupt", "Torkoal", "Spoink", "Grumpig",
            "Spinda", "Trapinch", "Vibrava", "Flygon", "Cacnea", "Cacturne", "Swablu", "Altaria", "Zangoose", "Seviper",
            "Lunatone", "Solrock", "Barboach", "Whiscash", "Corphish", "Crawdaunt", "Baltoy", "Claydol", "Lileep",
            "Cradily", "Anorith", "Armaldo", "Feebas", "Milotic", "Castform", "Kecleon", "Shuppet", "Banette", "Duskull",
            "Dusclops", "Tropius", "Chimecho", "Absol", "Wynaut", "Snorunt", "Glalie", "Spheal", "Sealeo", "Walrein",
            "Clamperl", "Huntail", "Gorebyss", "Relicanth", "Luvdisc", "Bagon", "Shelgon", "Salamence", "Beldum",
            "Metang", "Metagross", "Regirock", "Regice", "Registeel", "Latias", "Latios", "Kyogre", "Groudon",
            "Rayquaza", "Jirachi", "Deoxys",
            // Gen 4
            "Turtwig", "Grotle", "Torterra", "Chimchar", "Monferno", "Infernape", "Piplup", "Prinplup", "Empoleon",
            "Starly", "Staravia", "Staraptor", "Bidoof", "Bibarel", "Kricketot", "Kricketune", "Shinx", "Luxio",
            "Luxray", "Budew", "Roserade", "Cranidos", "Rampardos", "Shieldon", "Bastiodon", "Burmy", "Wormadam",
            "Mothim", "Combee", "Vespiquen", "Pachirisu", "Buizel", "Floatzel", "Cherubi", "Cherrim", "Shellos",
            "Gastrodon", "Ambipom", "Drifloon", "Drifblim", "Buneary", "Lopunny", "Mismagius", "Honchkrow", "Glameow",
            "Purugly", "Chingling", "Stunky", "Skuntank", "Bronzor", "Bronzong", "Bonsly", "Mime Jr.", "Happiny",
            "Chatot", "Spiritomb", "Gible", "Gabite", "Garchomp", "Munchlax", "Riolu", "Lucario", "Hippopotas",
            "Hippowdon", "Skorupi", "Drapion", "Croagunk", "Toxicroak", "Carnivine", "Finneon", "Lumineon", "Mantyke",
            "Snover", "Abomasnow", "Weavile", "Magnezone", "Lickilicky", "Rhyperior", "Tangrowth", "Electivire",
            "Magmortar", "Togekiss", "Yanmega", "Leafeon", "Glaceon", "Gliscor", "Mamoswine", "Porygon-Z", "Gallade",
            "Probopass", "Dusknoir", "Froslass", "Rotom", "Uxie", "Mesprit", "Azelf", "Dialga", "Palkia", "Heatran",
            "Regigigas", "Giratina", "Cresselia", "Phione", "Manaphy", "Darkrai", "Shaymin", "Arceus",
            // Gen 5
            "Victini", "Snivy", "Servine", "Serperior", "Tepig", "Pignite", "Emboar", "Oshawott", "Dewott", "Samurott",
            "Patrat", "Watchog", "Lillipup", "Herdier", "Stoutland", "Purrloin", "Liepard", "Pansage", "Simisage",
            "Pansear", "Simisear", "Panpour", "Simipour", "Munna", "Musharna", "Pidove", "Tranquill", "Unfezant",
            "Blitzle", "Zebstrika", "Roggenrola", "Boldore", "Gigalith", "Woobat", "Swoobat", "Drilbur", "Excadrill",
            "Audino", "Timburr", "Gurdurr", "Conkeldurr", "Tympole", "Palpitoad", "Seismitoad", "Throh", "Sawk",
            "Sewaddle", "Swadloon", "Leavanny", "Venipede", "Whirlipede", "Scolipede", "Cottonee", "Whimsicott",
            "Petilil", "Lilligant", "Basculin", "Sandile", "Krokorok", "Krookodile", "Darumaka", "Darmanitan",
            "Maractus", "Dwebble", "Crustle", "Scraggy", "Scrafty", "Sigilyph", "Yamask", "Cofagrigus", "Tirtouga",
            "Carracosta", "Archen", "Archeops", "Trubbish", "Garbodor", "Zorua", "Zoroark", "Minccino", "Cinccino",
            "Gothita", "Gothorita", "Gothitelle", "Solosis", "Duosion", "Reuniclus", "Ducklett", "Swanna", "Vanillite",
            "Vanillish", "Vanilluxe", "Deerling", "Sawsbuck", "Emolga", "Karrablast", "Escavalier", "Foongus",
            "Amoonguss", "Frillish", "Jellicent", "Alomomola", "Joltik", "Galvantula", "Ferroseed", "Ferrothorn",
            "Klink", "Klang", "Klinklang", "Tynamo", "Eelektrik", "Eelektross", "Elgyem", "Beheeyem", "Litwick",
            "Lampent", "Chandelure", "Axew", "Fraxure", "Haxorus", "Cubchoo", "Beartic", "Cryogonal", "Shelmet",
            "Accelgor", "Stunfisk", "Mienfoo", "Mienshao", "Druddigon", "Golett", "Golurk", "Pawniard", "Bisharp",
            "Bouffalant", "Rufflet", "Braviary", "Vullaby", "Mandibuzz", "Heatmor", "Durant", "Deino", "Zweilous",
            "Hydreigon", "Larvesta", "Volcarona", "Cobalion", "Terrakion", "Virizion", "Tornadus", "Thundurus",
            "Reshiram", "Zekrom", "Landorus", "Kyurem", "Keldeo", "Meloetta", "Genesect",
            // Gen 6
            "Chespin", "Quilladin", "Chesnaught", "Fennekin", "Braixen", "Delphox", "Froakie", "Frogadier", "Greninja",
            "Bunnelby", "Diggersby", "Fletchling", "Fletchinder", "Talonflame", "Scatterbug", "Spewpa", "Vivillon",
            "Litleo", "Pyroar", "Flabébé", "Floette", "Florges", "Skiddo", "Gogoat", "Pancham", "Pangoro", "Furfrou",
            "Espurr", "Meowstic", "Honedge", "Doublade", "Aegislash", "Spritzee", "Aromatisse", "Swirlix", "Slurpuff",
            "Inkay", "Malamar", "Binacle", "Barbaracle", "Skrelp", "Dragalge", "Clauncher", "Clawitzer", "Helioptile",
            "Heliolisk", "Tyrunt", "Tyrantrum", "Amaura", "Aurorus", "Sylveon", "Hawlucha", "Dedenne", "Carbink",
            "Goomy", "Sliggoo", "Goodra", "Klefki", "Phantump", "Trevenant", "Pumpkaboo", "Gourgeist", "Bergmite",
            "Avalugg", "Noibat", "Noivern", "Xerneas", "Yveltal", "Zygarde", "Diancie", "Hoopa", "Volcanion",
            // Gen 7
            "Rowlet", "Dartrix", "Decidueye", "Litten", "Torracat", "Incineroar", "Popplio", "Brionne", "Primarina",
            "Pikipek", "Trumbeak", "Toucannon", "Yungoos", "Gumshoos", "Grubbin", "Charjabug", "Vikavolt", "Crabrawler",
            "Crabominable", "Oricorio", "Cutiefly", "Ribombee", "Rockruff", "Lycanroc", "Wishiwashi", "Mareanie",
            "Toxapex", "Mudbray", "Mudsdale", "Dewpider", "Araquanid", "Fomantis", "Lurantis", "Morelull", "Shiinotic",
            "Salandit", "Salazzle", "Stufful", "Bewear", "Bounsweet", "Steenee", "Tsareena", "Comfey", "Oranguru",
            "Passimian", "Wimpod", "Golisopod", "Sandygast", "Palossand", "Pyukumuku", "Type: Null", "Silvally",
            "Minior", "Komala", "Turtonator", "Togedemaru", "Mimikyu", "Bruxish", "Drampa", "Dhelmise", "Jangmo-o",
            "Hakamo-o", "Kommo-o", "Tapu Koko", "Tapu Lele", "Tapu Bulu", "Tapu Fini", "Cosmog", "Cosmoem", "Solgaleo",
            "Lunala", "Nihilego", "Buzzwole", "Pheromosa", "Xurkitree", "Celesteela", "Kartana", "Guzzlord",
            "Necrozma", "Magearna", "Marshadow", "Poipole", "Naganadel", "Stakataka", "Blacephalon", "Zeraora",
            "Meltan", "Melmetal",
            // Gen 8
            "Grookey", "Thwackey", "Rillaboom", "Scorbunny", "Raboot", "Cinderace", "Sobble", "Drizzile", "Inteleon",
            "Skwovet", "Greedent", "Rookidee", "Corvisquire", "Corviknight", "Blipbug", "Dottler", "Orbeetle",
            "Nickit", "Thievul", "Gossifleur", "Eldegoss", "Wooloo", "Dubwool", "Chewtle", "Drednaw", "Yamper",
            "Boltund", "Rolycoly", "Carkol", "Coalossal", "Applin", "Flapple", "Appletun", "Silicobra", "Sandaconda",
            "Cramorant", "Arrokuda", "Barraskewda", "Toxel", "Toxtricity", "Sizzlipede", "Centiskorch", "Clobbopus",
            "Grapploct", "Sinistea", "Polteageist", "Hatenna", "Hattrem", "Hatterene", "Impidimp", "Morgrem",
            "Grimmsnarl", "Obstagoon", "Perrserker", "Cursola", "Sirfetch'd", "Mr. Rime", "Runerigus", "Milcery",
            "Alcremie", "Falinks", "Pincurchin", "Snom", "Frosmoth", "Stonjourner", "Eiscue", "Indeedee", "Morpeko",
            "Cufant", "Copperajah", "Dracozolt", "Arctozolt", "Dracovish", "Arctovish", "Duraludon", "Dreepy",
            "Drakloak", "Dragapult", "Zacian", "Zamazenta", "Eternatus", "Kubfu", "Urshifu", "Zarude", "Regieleki",
            "Regidrago", "Glastrier", "Spectrier", "Calyrex", "Wyrdeer", "Kleavor", "Ursaluna", "Basculegion",
            "Sneasler", "Overqwil", "Enamorus",
             // Gen 9
             "Sprigatito", "Floragato", "Meowscarada", "Fuecoco", "Crocalor", "Skeledirge", "Quaxly", "Quaxwell", "Quaquaval",
             "Lechonk", "Oinkologne", "Tarountula", "Spidops", "Nymble", "Lokix", "Pawmi", "Pawmo", "Pawmot", "Tandemaus",
             "Maushold", "Fidough", "Dachsbun", "Smoliv", "Dolliv", "Arboliva", "Squawkabilly", "Nacli", "Naclstack",
             "Garganacl", "Charcadet", "Armarouge", "Ceruledge", "Tadbulb", "Bellibolt", "Wattrel", "Kilowattrel",
             "Maschiff", "Mabosstiff", "Shroodle", "Grafaiai", "Bramblin", "Brambleghast", "Toedscool", "Toedscruel",
             "Klawf", "Capsakid", "Scovillain", "Rellor", "Rabsca", "Flittle", "Espathra", "Tinkatink", "Tinkatuff",
             "Tinkaton", "Wiglett", "Wugtrio", "Bombirdier", "Finizen", "Palafin", "Varoom", "Revavroom", "Cyclizar",
             "Orthworm", "Glimmet", "Glimmora", "Greavard", "Houndstone", "Flamigo", "Cetoddle", "Cetitan", "Veluza",
             "Dondozo", "Tatsugiri", "Annihilape", "Clodsire", "Farigiraf", "Dudunsparce", "Kingambit", "Great Tusk",
             "Scream Tail", "Brute Bonnet", "Flutter Mane", "Slither Wing", "Sandy Shocks", "Iron Treads", "Iron Bundle",
             "Iron Hands", "Iron Jugulis", "Iron Moth", "Iron Thorns", "Frigibax", "Arctibax", "Baxcalibur", "Gimmighoul",
             "Gholdengo", "Wo-Chien", "Chien-Pao", "Ting-Lu", "Chi-Yu", "Roaring Moon", "Iron Valiant", "Koraidon",
             "Miraidon", "Walking Wake", "Iron Leaves", "Pecharunt", "Okidogi", "Munkidori", "Fezandipiti", "Terapagos"
        ].sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase())); // Pre-sort

        // ***** END OF UPDATED LIST *****

        let setNames = []; // To be populated by API

        // --- Function to Fetch Set Names ---
        async function fetchSetNames() {
            const setsApiUrl = 'https://api.pokemontcg.io/v2/sets?select=name&orderBy=releaseDate';
            try {
                const response = await fetch(setsApiUrl);
                if (!response.ok) throw new Error(`Failed to fetch sets: ${response.status}`);
                const data = await response.json();
                setNames = data.data.map(set => set.name).sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));
                console.log(`Loaded ${setNames.length} set names.`);
            } catch (error) {
                console.error("Error fetching set names:", error);
                setNames = [];
            }
        }

        // --- Function to Show/Hide Suggestions (Takes target input and container) ---
        function displaySuggestions(inputText, suggestionsList, targetInput, targetContainer) {
            targetContainer.innerHTML = '';
            if (inputText.length < 1 || suggestionsList.length === 0) {
                targetContainer.style.display = 'none';
                return;
            }
            const filtered = suggestionsList.filter(suggestion =>
                suggestion.toLowerCase().startsWith(inputText.toLowerCase())
            );
            if (filtered.length === 0) {
                targetContainer.style.display = 'none';
                return;
            }
            filtered.slice(0, 8).forEach(suggestion => {
                const item = document.createElement('div');
                item.classList.add('suggestion-item');
                item.textContent = suggestion;
                item.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    targetInput.value = suggestion;
                    targetContainer.style.display = 'none';
                });
                targetContainer.appendChild(item);
            });
            targetContainer.style.display = 'block';
        }

        // --- Hide Specific Suggestion Container ---
        function hideSuggestions(container) {
             if (container) container.style.display = 'none';
        }
        // --- Hide ALL Suggestion Containers ---
        function hideAllSuggestions() {
             hideSuggestions(pokemonSuggestionsContainer);
             hideSuggestions(setSuggestionsContainer);
        }

        // --- Initial Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            showInitialMessage();
            fetchSetNames();
        });

        // --- Updated showInitialMessage for Placeholder ---
        function showInitialMessage() {
            resultsDiv.innerHTML = '<p class="message">Enter a Pokémon name and/or Set name to find TCG cards!</p>';
            resultsDiv.classList.add('results-placeholder');
            loader.style.display = 'none';
            clearPagination();
            hideAllSuggestions();
        }

        // --- Updated fetchCards function ---
        async function fetchCards(pokemonName, setName, page = 1) {
            currentPokemonName = pokemonName.trim();
            currentSetName = setName.trim();
            currentPage = page;
            hideAllSuggestions();
            resultsDiv.classList.remove('results-placeholder');
            if (!currentPokemonName && !currentSetName) {
                resultsDiv.innerHTML = '<p class="message error">Please enter a Pokémon Name or Set Name.</p>';
                clearPagination();
                loader.style.display = 'none';
                return;
            }
            if (currentAbortController) currentAbortController.abort();
            currentAbortController = new AbortController();
            const signal = currentAbortController.signal;
            resultsDiv.innerHTML = '';
            clearPagination();
            loader.style.display = 'block';
            let queryParts = [];
            if (currentPokemonName) queryParts.push(`name:"${currentPokemonName.replace(/"/g, '\\"')}*"`);
            if (currentSetName) queryParts.push(`set.name:"${currentSetName.replace(/"/g, '\\"')}*"`);
            const query = queryParts.join(' ');
            const apiUrl = `https://api.pokemontcg.io/v2/cards?q=${encodeURIComponent(query)}&orderBy=set.releaseDate,name&page=${page}&pageSize=${pageSize}`;
            try {
                const response = await fetch(apiUrl, { signal });
                if (!response.ok) {
                    let errorMsg = `API error (${response.status})`;
                    try { errorMsg += `: ${ (await response.json()).error.message }`; }
                    catch (e) { errorMsg += `. ${response.statusText}`; }
                    throw new Error(errorMsg);
                }
                const data = await response.json();
                loader.style.display = 'none';
                if (!data.data || data.data.length === 0) {
                    let message = "No cards found";
                    if (currentPokemonName && currentSetName) message += ` matching "${currentPokemonName}" in set "${currentSetName}"`;
                    else if (currentPokemonName) message += ` matching "${currentPokemonName}"`;
                    else if (currentSetName) message += ` in set "${currentSetName}"`;
                    message += ". Try a different search!";
                    resultsDiv.innerHTML = `<p class="message">${message}</p>`;
                    totalPages = 1;
                } else {
                    totalPages = Math.ceil(data.totalCount / data.pageSize);
                    displayCards(data.data);
                }
                renderPaginationControls();
                if (page > 1) document.getElementById('container')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } catch (error) {
                loader.style.display = 'none';
                clearPagination();
                resultsDiv.classList.remove('results-placeholder');
                if (error.name === 'AbortError') { console.log('Fetch aborted'); showInitialMessage(); }
                else { console.error("Error fetching cards:", error); resultsDiv.innerHTML = `<p class="message error">Error: ${error.message}. Please check the term or API status.</p>`; }
            } finally {
                if (loader.style.display === 'block') loader.style.display = 'none';
                 if (!resultsDiv.classList.contains('results-placeholder')) {
                     const initialMsgElement = resultsDiv.querySelector('p.message');
                     if (!initialMsgElement || !initialMsgElement.textContent.startsWith('Enter a Pokémon name')) {
                         resultsDiv.classList.remove('results-placeholder');
                     }
                 }
                currentAbortController = null;
            }
        }

        // --- displayCards function (unchanged) ---
        function displayCards(cards) {
            resultsDiv.classList.remove('results-placeholder');
            if (!cards || cards.length === 0) return;
            cards.forEach(card => {
                if (card.images?.small && card.name && card.set?.name) {
                    const cardContainer = document.createElement('div'); cardContainer.classList.add('card-container');
                    const img = document.createElement('img'); img.src = card.images.small; img.alt = `Card: ${card.name} - Set: ${card.set.name}`; img.title = `Click to enlarge\nName: ${card.name}\nSet: ${card.set.name}\nRarity: ${card.rarity || 'N/A'}`; img.classList.add('card-image'); img.loading = 'lazy'; img.addEventListener('click', () => openModal(card.images.large));
                    const infoDiv = document.createElement('div'); infoDiv.classList.add('card-info'); let marketLinkHTML = '';
                    if (card.tcgplayer && card.tcgplayer.url) { const affiliateUrl = card.tcgplayer.url; marketLinkHTML = `<a href="${affiliateUrl}" class="market-link" target="_blank" rel="noopener noreferrer" title="View ${card.name} from ${card.set.name} on TCGplayer">View on TCGplayer</a>`; }
                    infoDiv.innerHTML = `<strong>${card.set.name}</strong><span>Rarity: ${card.rarity || 'Common'}</span>${marketLinkHTML}`;
                    cardContainer.appendChild(img); cardContainer.appendChild(infoDiv); resultsDiv.appendChild(cardContainer);
                } else { console.warn("Skipping card due to missing data:", card.id, card.name, card.set?.name, card.images?.small); }
            });
        }

        // --- renderPaginationControls function (unchanged) ---
         function renderPaginationControls() {
            paginationControlsDiv.innerHTML = ''; if (totalPages <= 1) return;
            const prevButton = document.createElement('button'); prevButton.textContent = '← Previous'; prevButton.classList.add('pagination-button'); prevButton.disabled = (currentPage === 1); prevButton.setAttribute('aria-label', 'Go to previous page'); prevButton.addEventListener('click', () => { if (currentPage > 1) fetchCards(currentPokemonName, currentSetName, currentPage - 1); });
            const pageInfo = document.createElement('span'); pageInfo.id = 'page-info'; pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
            const nextButton = document.createElement('button'); nextButton.textContent = 'Next →'; nextButton.classList.add('pagination-button'); nextButton.disabled = (currentPage >= totalPages); nextButton.setAttribute('aria-label', 'Go to next page'); nextButton.addEventListener('click', () => { if (currentPage < totalPages) fetchCards(currentPokemonName, currentSetName, currentPage + 1); });
            paginationControlsDiv.appendChild(prevButton); paginationControlsDiv.appendChild(pageInfo); paginationControlsDiv.appendChild(nextButton);
        }

        function clearPagination() { paginationControlsDiv.innerHTML = ''; }

        // --- Modal Functions (unchanged) ---
        function openModal(imageUrl) { if (imageUrl) { modalImage.src = imageUrl; modal.style.display = "block"; document.body.style.overflow = 'hidden'; } }
        function closeModal() { modal.style.display = "none"; modalImage.src = ""; document.body.style.overflow = ''; }

        // --- Event Listeners (Updated for two inputs and autocomplete) ---
        searchButton.addEventListener('click', () => { const nameTerm = pokemonNameInput.value; const setTerm = setNameInput.value; hideAllSuggestions(); fetchCards(nameTerm, setTerm, 1); });
        pokemonNameInput.addEventListener('keypress', handleEnterKey); setNameInput.addEventListener('keypress', handleEnterKey);
        function handleEnterKey(event) { if (event.key === 'Enter') { event.preventDefault(); const nameTerm = pokemonNameInput.value; const setTerm = setNameInput.value; hideAllSuggestions(); fetchCards(nameTerm, setTerm, 1); } }

        // --- Autocomplete Event Listeners ---
        pokemonNameInput.addEventListener('input', () => { displaySuggestions(pokemonNameInput.value.trim(), pokemonNames, pokemonNameInput, pokemonSuggestionsContainer); hideSuggestions(setSuggestionsContainer); });
        setNameInput.addEventListener('input', () => { displaySuggestions(setNameInput.value.trim(), setNames, setNameInput, setSuggestionsContainer); hideSuggestions(pokemonSuggestionsContainer); });
        document.addEventListener('click', (event) => { if (!pokemonNameInput.contains(event.target) && !pokemonSuggestionsContainer.contains(event.target)) hideSuggestions(pokemonSuggestionsContainer); if (!setNameInput.contains(event.target) && !setSuggestionsContainer.contains(event.target)) hideSuggestions(setSuggestionsContainer); });
        pokemonNameInput.addEventListener('blur', () => { setTimeout(() => { if (!pokemonSuggestionsContainer.contains(document.activeElement)) hideSuggestions(pokemonSuggestionsContainer); }, 150); });
        setNameInput.addEventListener('blur', () => { setTimeout(() => { if (!setSuggestionsContainer.contains(document.activeElement)) hideSuggestions(setSuggestionsContainer); }, 150); });
        pokemonNameInput.addEventListener('keydown', (event) => { if (event.key === 'Escape') hideSuggestions(pokemonSuggestionsContainer); });
        setNameInput.addEventListener('keydown', (event) => { if (event.key === 'Escape') hideSuggestions(setSuggestionsContainer); });

        // --- Modal Event Listeners ---
        closeModalSpan.addEventListener('click', closeModal); modal.addEventListener('click', (event) => { if (event.target === modal) closeModal(); }); window.addEventListener('keydown', (event) => { if (event.key === 'Escape' && modal.style.display === 'block') closeModal(); });

        // --- Footer Credits Function ---
        function addFooterCredits() { if(footerElement) { const currentYear = new Date().getFullYear(); footerElement.innerHTML = `Made with <span class="heart">❤️</span> by <span class="creator-name">Amadou</span> © ${currentYear}. Happy Collecting! <br> Card data powered by <a href="https://pokemontcg.io/" target="_blank" rel="noopener noreferrer">pokemontcg.io API</a>. Market links go to TCGplayer.com.`; } else { console.warn("Footer element (#page-footer) not found."); } }
        addFooterCredits();

    </script>

</body>
</html>